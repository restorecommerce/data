---
  id: fbff989edf064ae680ccd9df7c946f3f
  name: Fallback rule
  description: Fallback rule
  effect: DENY
  target:
    subjects:
      - id: urn:restorecommerce:acs:names:role
        value: user-r-id # NormalUser
    actions: []
    resources: []
  condition: ""
  evaluationCacheable: false
  contextQuery:
    filters: []
    query: ""
  meta:
    modifiedBy: ""
    owners:
      - id: urn:restorecommerce:acs:names:ownerIndicatoryEntity
        value: urn:restorecommerce:acs:model:organization.Organization
      - id: urn:restorecommerce:acs:names:ownerInstance
        value: r-ug
---
  id: aabfb8ed51064baaa3eafe43d3d4c44e
  name: User read rule
  description: Permits any read if the resource is under an organizational hierarchical scope
  target:
    subjects:
      - id: urn:restorecommerce:acs:names:role
        value: user-r-id # NormalUser
    actions:
      - id: urn:oasis:names:tc:xacml:1.0:action:action-id
        value: urn:restorecommerce:acs:names:action:read
    resources:
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:user.User
  condition:
    "
      const resources = target.resources;
      let isUser = false;
      let userID;
      for (let attribute of resources) {
        if (attribute.id == 'urn:restorecommerce:acs:names:model:entity') {
          isUser = (attribute.value == 'urn:restorecommerce:acs:model:user.User');
        }
        if (isUser) {
          userID = context.subject.id;
        }
      }
      userID;
    "
  effect: PERMIT
  evaluationCacheable: false
  contextQuery:
    filters: [ ]
    query: ""
  meta:
    modifiedBy: ""
    owners:
      - id: urn:restorecommerce:acs:names:ownerIndicatoryEntity
        value: urn:restorecommerce:acs:model:organization.Organization
      - id: urn:restorecommerce:acs:names:ownerInstance
        value: r-ug
---
  id: d892b81c25064a848f0dafb55093bbdf
  name: Organization read rule
  description: Permits any read if the resource is under an organizational hierarchical scope
  target:
    subjects:
      - id: urn:restorecommerce:acs:names:role
        value: user-r-id # NormalUser
      - id: urn:restorecommerce:acs:names:roleScopingEntity
        value: urn:restorecommerce:acs:model:organization.Organization
    actions:
      - id: urn:oasis:names:tc:xacml:1.0:action:action-id
        value: urn:restorecommerce:acs:names:action:read
    resources:
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:organization.Organization
  effect: PERMIT
  condition: ""
  evaluationCacheable: false
  contextQuery:
    filters: [ ]
    query: ""
  meta:
    modifiedBy: ""
    owners:
      - id: urn:restorecommerce:acs:names:ownerIndicatoryEntity
        value: urn:restorecommerce:acs:model:organization.Organization
      - id: urn:restorecommerce:acs:names:ownerInstance
        value: r-ug
---
  id: bbc1f8622b1049d9b54a66237d4fd651
  name: Address read rule
  description: Permits any read if the resource is under an organizational hierarchical scope
  target:
    subjects:
      - id: urn:restorecommerce:acs:names:role
        value: user-r-id # NormalUser
      - id: urn:restorecommerce:acs:names:roleScopingEntity
        value: urn:restorecommerce:acs:model:organization.Organization
    actions:
      - id: urn:oasis:names:tc:xacml:1.0:action:action-id
        value: urn:restorecommerce:acs:names:action:read
    resources:
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:address.Address
  effect: PERMIT
  condition: ""
  evaluationCacheable: false
  contextQuery:
    filters: [ ]
    query: ""
  meta:
    modifiedBy: ""
    owners:
      - id: urn:restorecommerce:acs:names:ownerIndicatoryEntity
        value: urn:restorecommerce:acs:model:organization.Organization
      - id: urn:restorecommerce:acs:names:ownerInstance
        value: r-ug
---
  id: 4509c76b54c44d0584b2a652a789e44e
  name: ContactPoint read rule
  description: Permits any read if the resource is under an organizational hierarchical scope
  target:
    subjects:
      - id: urn:restorecommerce:acs:names:role
        value: user-r-id # NormalUser
      - id: urn:restorecommerce:acs:names:roleScopingEntity
        value: urn:restorecommerce:acs:model:organization.Organization
    actions:
      - id: urn:oasis:names:tc:xacml:1.0:action:action-id
        value: urn:restorecommerce:acs:names:action:read
    resources:
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:contact_point.ContactPoint
  effect: PERMIT
  condition: ""
  evaluationCacheable: false
  contextQuery:
    filters: [ ]
    query: ""
  meta:
    modifiedBy: ""
    owners:
      - id: urn:restorecommerce:acs:names:ownerIndicatoryEntity
        value: urn:restorecommerce:acs:model:organization.Organization
      - id: urn:restorecommerce:acs:names:ownerInstance
        value: r-ug
---
  id: 402e831240284451968457d2549d9ffb
  name: ContactPointType read rule
  description: Permits read for all users in any Organization
  target:
    subjects:
      - id: urn:restorecommerce:acs:names:role
        value: user-r-id # NormalUser
    actions:
      - id: urn:oasis:names:tc:xacml:1.0:action:action-id
        value: urn:restorecommerce:acs:names:action:read
    resources:
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:contact_point_type.ContactPointType
  effect: PERMIT
  condition: ""
  evaluationCacheable: false
  contextQuery:
    filters: [ ]
    query: ""
  meta:
    modifiedBy: ""
    owners:
      - id: urn:restorecommerce:acs:names:ownerIndicatoryEntity
        value: urn:restorecommerce:acs:model:organization.Organization
      - id: urn:restorecommerce:acs:names:ownerInstance
        value: r-ug
---
  id: 19eefaa16fff42bf881c16eca946b029
  name: Locale read rule
  description: Permits read for all users in any Organization
  target:
    subjects:
      - id: urn:restorecommerce:acs:names:role
        value: user-r-id # NormalUser
    actions:
      - id: urn:oasis:names:tc:xacml:1.0:action:action-id
        value: urn:restorecommerce:acs:names:action:read
    resources:
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:locale.Locale
  effect: PERMIT
  condition: ""
  evaluationCacheable: false
  contextQuery:
    filters: [ ]
    query: ""
  meta:
    modifiedBy: ""
    owners:
      - id: urn:restorecommerce:acs:names:ownerIndicatoryEntity
        value: urn:restorecommerce:acs:model:organization.Organization
      - id: urn:restorecommerce:acs:names:ownerInstance
        value: r-ug
---
  id: 94140965831f46deb1eebf9ab36c4572
  name: Timezone read rule
  description: Permits read for all users
  target:
    subjects:
      - id: urn:restorecommerce:acs:names:role
        value: user-r-id # NormalUser
    actions:
      - id: urn:oasis:names:tc:xacml:1.0:action:action-id
        value: urn:restorecommerce:acs:names:action:read
    resources:
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:timezone.Timezone
  effect: PERMIT
  condition: ""
  evaluationCacheable: false
  contextQuery:
    filters: [ ]
    query: ""
  meta:
    modifiedBy: ""
    owners:
      - id: urn:restorecommerce:acs:names:ownerIndicatoryEntity
        value: urn:restorecommerce:acs:model:organization.Organization
      - id: urn:restorecommerce:acs:names:ownerInstance
        value: r-ug
---
  id: 43cd9e2b462a426ca30d2a1bcb1e54c8
  name: Role read rule
  description: Only Admin should be allowed to read all Roles in system
  target:
    subjects:
      - id: urn:restorecommerce:acs:names:role
        value: user-r-id # NormalUser
      - id: urn:restorecommerce:acs:names:role
        value: administrator-r-id # Admin
    actions:
      - id: urn:oasis:names:tc:xacml:1.0:action:action-id
        value: urn:restorecommerce:acs:names:action:read
    resources:
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:role.Role
  effect: PERMIT
  condition: ""
  evaluationCacheable: false
  contextQuery:
    filters: [ ]
    query: ""
  meta:
    modifiedBy: ""
    owners:
      - id: urn:restorecommerce:acs:names:ownerIndicatoryEntity
        value: urn:restorecommerce:acs:model:organization.Organization
      - id: urn:restorecommerce:acs:names:ownerInstance
        value: r-ug
---
  id: a0325bfbbdd84dd59274b09ca0c7e239
  name: Role SuperAdmin read rule
  description: SuperAdmin role should not be readable
  target:
    subjects:
      - id: urn:restorecommerce:acs:names:role
        value: user-r-id # NormalUser
    actions:
      - id: urn:oasis:names:tc:xacml:1.0:action:action-id
        value: urn:restorecommerce:acs:names:action:read
    resources:
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:role.Role
      - id: urn:oasis:names:tc:xacml:1.0:resource:resource-id
        value: superadministrator-r-id
  effect: DENY
  condition: ""
  evaluationCacheable: false
  contextQuery:
    filters: [ ]
    query: ""
  meta:
    modifiedBy: ""
    owners:
      - id: urn:restorecommerce:acs:names:ownerIndicatoryEntity
        value: urn:restorecommerce:acs:model:organization.Organization
      - id: urn:restorecommerce:acs:names:ownerInstance
        value: r-ug
---
  id: f7ae06e4d33b4340b351945ed6339143
  name: Tax read rule
  description: Permits read for all users in any Organization
  target:
    subjects:
      - id: urn:restorecommerce:acs:names:role
        value: user-r-id # NormalUser
    actions:
      - id: urn:oasis:names:tc:xacml:1.0:action:action-id
        value: urn:restorecommerce:acs:names:action:read
    resources:
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:tax.Tax
  effect: PERMIT
  condition: ""
  evaluationCacheable: false
  contextQuery:
    filters: [ ]
    query: ""
  meta:
    modifiedBy: ""
    owners:
      - id: urn:restorecommerce:acs:names:ownerIndicatoryEntity
        value: urn:restorecommerce:acs:model:organization.Organization
      - id: urn:restorecommerce:acs:names:ownerInstance
        value: r-ug
---
  id: 72a509eeaf8e4f5ba999116c6c797f0b
  name: TaxType read rule
  description: Permits read for all users in any Organization
  target:
    subjects:
      - id: urn:restorecommerce:acs:names:role
        value: user-r-id # NormalUser
    actions:
      - id: urn:oasis:names:tc:xacml:1.0:action:action-id
        value: urn:restorecommerce:acs:names:action:read
    resources:
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:tax_type.TaxType
  effect: PERMIT
  condition: ""
  evaluationCacheable: false
  contextQuery:
    filters: [ ]
    query: ""
  meta:
    modifiedBy: ""
    owners:
      - id: urn:restorecommerce:acs:names:ownerIndicatoryEntity
        value: urn:restorecommerce:acs:model:organization.Organization
      - id: urn:restorecommerce:acs:names:ownerInstance
        value: r-ug
---
  id: 0293e152015c41fb923e17c0589fe7d2
  name: Country read rule
  description: Permits read for all users in any Organization
  target:
    subjects:
      - id: urn:restorecommerce:acs:names:role
        value: user-r-id # NormalUser
    actions:
      - id: urn:oasis:names:tc:xacml:1.0:action:action-id
        value: urn:restorecommerce:acs:names:action:read
    resources:
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:country.Country
  effect: PERMIT
  condition: ""
  evaluationCacheable: false
  contextQuery:
    filters: [ ]
    query: ""
  meta:
    modifiedBy: ""
    owners:
      - id: urn:restorecommerce:acs:names:ownerIndicatoryEntity
        value: urn:restorecommerce:acs:model:organization.Organization
      - id: urn:restorecommerce:acs:names:ownerInstance
        value: r-ug
---
  id: 8f5fb142972e44ffbb136ca3770212da
  name: Register User rule
  description: Targets register
  target:
    subjects:
      - id: urn:restorecommerce:acs:names:unauthenticated-user
        value: "true"
    actions:
      - id: urn:oasis:names:tc:xacml:1.0:action:action-id
        value: urn:restorecommerce:acs:names:action:create
    resources:
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:user.User
  effect: PERMIT
  condition: ""
  evaluationCacheable: false
  contextQuery:
    filters: [ ]
    query: ""
  meta:
    modifiedBy: ""
    owners:
      - id: urn:restorecommerce:acs:names:ownerIndicatoryEntity
        value: urn:restorecommerce:acs:model:organization.Organization
      - id: urn:restorecommerce:acs:names:ownerInstance
        value: r-ug
---
  id: 27a50edd71d942e3b2812a30f1879acb
  name: User 'Forgot Password' rule
  description: Permits 'modify'  by unauthenticated users on their password
  target:
    subjects:
      - id: urn:restorecommerce:acs:names:unauthenticated-user
        value: "true"
    actions:
      - id: urn:oasis:names:tc:xacml:1.0:action:action-id
        value: urn:restorecommerce:acs:names:action:modify
    resources:
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:user.User
      - id: urn:restorecommerce:acs:names:model:property
        value: urn:restorecommerce:acs:model:user.User#activation_code
      - id: urn:restorecommerce:acs:names:model:property
        value: urn:restorecommerce:acs:model:user.User#password_hash
  effect: PERMIT
  condition: ""
  evaluationCacheable: false
  contextQuery:
    filters: [ ]
    query: ""
  meta:
    modifiedBy: ""
    owners:
      - id: urn:restorecommerce:acs:names:ownerIndicatoryEntity
        value: urn:restorecommerce:acs:model:organization.Organization
      - id: urn:restorecommerce:acs:names:ownerInstance
        value: r-ug
---
  id: 50e5c475987c4a83bb1acd9ff84af090
  name: User 'ConfirmEmailChange' rule
  description: Permits 'modify'  by unauthenticated users on their password
  target:
    subjects:
      - id: urn:restorecommerce:acs:names:unauthenticated-user
        value: "true"
    actions:
      - id: urn:oasis:names:tc:xacml:1.0:action:action-id
        value: urn:restorecommerce:acs:names:action:modify
    resources:
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:user.User
      - id: urn:restorecommerce:acs:names:model:property
        value: urn:restorecommerce:acs:model:user.User#activation_code
      - id: urn:restorecommerce:acs:names:model:property
        value: urn:restorecommerce:acs:model:user.User#email
  effect: PERMIT
  condition: ""
  evaluationCacheable: false
  contextQuery:
    filters: [ ]
    query: ""
  meta:
    modifiedBy: ""
    owners:
      - id: urn:restorecommerce:acs:names:ownerIndicatoryEntity
        value: urn:restorecommerce:acs:model:organization.Organization
      - id: urn:restorecommerce:acs:names:ownerInstance
        value: r-ug
---
  id: eeefbe2065c74c9d8ae7fa3e3ce7992e
  name: User Activation
  description: Permits 'modify' by unauthenticated users in case of activation
  target:
    subjects:
      - id: urn:restorecommerce:acs:names:unauthenticated-user
        value: "true"
    actions:
      - id: urn:oasis:names:tc:xacml:1.0:action:action-id
        value: urn:restorecommerce:acs:names:action:modify
    resources:
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:user.User
      - id: urn:restorecommerce:acs:names:model:property
        value: urn:restorecommerce:acs:model:user.User#active
      - id: urn:restorecommerce:acs:names:model:property
        value: urn:restorecommerce:acs:model:user.User#activation_code
  effect: PERMIT
  condition: ""
  evaluationCacheable: false
  contextQuery:
    filters: [ ]
    query: ""
  meta:
    modifiedBy: ""
    owners:
      - id: urn:restorecommerce:acs:names:ownerIndicatoryEntity
        value: urn:restorecommerce:acs:model:organization.Organization
      - id: urn:restorecommerce:acs:names:ownerInstance
        value: r-ug
---
  id: cc6e90accbb8453699fa658e1bc2f6c9
  name: User Account Rule
  description: Permits actions by any User on its own account data
  target:
    subjects:
      - id: urn:restorecommerce:acs:names:role
        value: user-r-id # Normal User
    resources:
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:user.User
    actions: []
  condition: # if it's the User's own account const { target, context } = request; # context.resources[0].instance.id
    "
      const resources = target.resources;

      let isUser = false;
      let match = false;
      for (let attribute of resources) {
        if (attribute.id == 'urn:restorecommerce:acs:names:model:entity') {
          isUser = (attribute.value == 'urn:restorecommerce:acs:model:user.User');
        } else if (attribute.id == 'urn:oasis:names:tc:xacml:1.0:resource:resource-id') {
          if (attribute.value == context.subject.id && isUser)
            match = true;
            isUser = false;
          } else {
            match = false;
            break;
          }
        }
      match;
    "
  effect: PERMIT
  evaluationCacheable: false
  contextQuery:
    filters: [ ]
    query: ""
  meta:
    modifiedBy: ""
    owners:
      - id: urn:restorecommerce:acs:names:ownerIndicatoryEntity
        value: urn:restorecommerce:acs:model:organization.Organization
      - id: urn:restorecommerce:acs:names:ownerInstance
        value: r-ug
---
  id: 2cda35a30992415b89066e06c09d9d4d
  name: User Admin Rule
  description: Permits if subject is Admin within the resource's hierarchical scope
  target:
    subjects:
      - id: urn:restorecommerce:acs:names:role
        value: administrator-r-id # Admin
      - id: urn:restorecommerce:acs:names:roleScopingEntity
        value: urn:restorecommerce:acs:model:organization.Organization
    resources:
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:user.User
    actions: []
  effect: PERMIT
  condition: ""
  evaluationCacheable: false
  contextQuery:
    filters: [ ]
    query: ""
  meta:
    modifiedBy: ""
    owners:
      - id: urn:restorecommerce:acs:names:ownerIndicatoryEntity
        value: urn:restorecommerce:acs:model:organization.Organization
      - id: urn:restorecommerce:acs:names:ownerInstance
        value: r-ug
---
  id: 4f039ce5635e4cf0bb422dcd68f732c9
  name: Organization Admin Rule
  description: Permits if subject is Admin within the resource's hierarchical scope
  target:
    subjects:
      - id: urn:restorecommerce:acs:names:role
        value: administrator-r-id # Admin
      - id: urn:restorecommerce:acs:names:roleScopingEntity
        value: urn:restorecommerce:acs:model:organization.Organization
    resources:
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:organization.Organization
    actions: []
  effect: PERMIT
  condition: ""
  evaluationCacheable: false
  contextQuery:
    filters: [ ]
    query: ""
  meta:
    modifiedBy: ""
    owners:
      - id: urn:restorecommerce:acs:names:ownerIndicatoryEntity
        value: urn:restorecommerce:acs:model:organization.Organization
      - id: urn:restorecommerce:acs:names:ownerInstance
        value: r-ug
---
  id: 7d9561f3d6cb4a03bdcc56f75dc2776a
  name: Address Admin Rule
  description: Permits if subject is Admin within the resource's hierarchical scope
  target:
    subjects:
      - id: urn:restorecommerce:acs:names:role
        value: administrator-r-id # Admin
      - id: urn:restorecommerce:acs:names:roleScopingEntity
        value: urn:restorecommerce:acs:model:organization.Organization
    resources:
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:address.Address
    actions: []
  effect: PERMIT
  condition: ""
  evaluationCacheable: false
  contextQuery:
    filters: [ ]
    query: ""
  meta:
    modifiedBy: ""
    owners:
      - id: urn:restorecommerce:acs:names:ownerIndicatoryEntity
        value: urn:restorecommerce:acs:model:organization.Organization
      - id: urn:restorecommerce:acs:names:ownerInstance
        value: r-ug
---
  id: b59a29b5b01e40d1ae5bb44240d906f7
  name: ContactPoint Admin Rule
  description: Permits if subject is Admin within the resource's hierarchical scope
  target:
    subjects:
      - id: urn:restorecommerce:acs:names:role
        value: administrator-r-id # Admin
      - id: urn:restorecommerce:acs:names:roleScopingEntity
        value: urn:restorecommerce:acs:model:organization.Organization
    resources:
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:contact_point.ContactPoint
    actions: [ ]
  effect: PERMIT
  condition: ""
  evaluationCacheable: false
  contextQuery:
    filters: [ ]
    query: ""
  meta:
    modifiedBy: ""
    owners:
      - id: urn:restorecommerce:acs:names:ownerIndicatoryEntity
        value: urn:restorecommerce:acs:model:organization.Organization
      - id: urn:restorecommerce:acs:names:ownerInstance
        value: r-ug
# Special Rules
---
  id: aa78cbecdbac4b53a914f5836b744c2d
  name: DeleteOrg Rule
  description: Rule targeting the `DeleteOrgData` mutation
  target:
    resources:
      - id: urn:restorecommerce:acs:names:operation
        value: mutation.deleteOrgData
    actions:
      - id: urn:oasis:names:tc:xacml:1.0:action:action-id
        value: urn:restorecommerce:acs:names:action:execute
    subjects:
      - id: urn:restorecommerce:acs:names:role
        value: superadministrator-r-id # SuperAdmin
  effect: PERMIT
  condition: ""
  evaluationCacheable: false
  contextQuery:
    filters: [ ]
    query: ""
  meta:
    modifiedBy: ""
    owners:
      - id: urn:restorecommerce:acs:names:ownerIndicatoryEntity
        value: urn:restorecommerce:acs:model:organization.Organization
      - id: urn:restorecommerce:acs:names:ownerInstance
        value: r-ug
---
  id: 2769c1a7e09f4971ad04fcca39094c2fx
  name: ExecuteCommand Rule
  description: Targets the `ExecuteCommand` mutation
  target:
    resources:
      - id: urn:restorecommerce:acs:names:operation
        value: mutation.executeCommand
    actions:
      - id: urn:oasis:names:tc:xacml:1.0:action:action-id
        value: urn:restorecommerce:acs:names:action:execute
    subjects:
      - id: urn:restorecommerce:acs:names:role
        value: superadministrator-r-id # SuperAdmin
  effect: PERMIT
  condition: ""
  evaluationCacheable: false
  contextQuery:
    filters: [ ]
    query: ""
  meta:
    
    modifiedBy: ""
    owners:
      - id: urn:restorecommerce:acs:names:ownerIndicatoryEntity
        value: urn:restorecommerce:acs:model:organization.Organization
      - id: urn:restorecommerce:acs:names:ownerInstance
        value: r-ug
---
  id: ff7da3d8aaca4b2cb66d324d4ff6f71d
  name: SuperAdmins Rule
  description: Permit anything by SuperAdmins (fallback rule)
  target:
    subjects:
      - id: urn:restorecommerce:acs:names:role
        value: superadministrator-r-id # SuperAdmin
    actions: [ ]
    resources: []
  effect: PERMIT
  condition: ""
  evaluationCacheable: false
  contextQuery:
    filters: [ ]
    query: ""
  meta:
    modifiedBy: ""
    owners:
      - id: urn:restorecommerce:acs:names:ownerIndicatoryEntity
        value: urn:restorecommerce:acs:model:organization.Organization
      - id: urn:restorecommerce:acs:names:ownerInstance
        value: r-ug
---
  id: 123d2f19370447ac82708c8a196bd3a9
  name: Order create read or modify rule
  description: Permits Order create, read or modify under an organizational hierarchical scope
  target:
    subjects:
      - id: urn:restorecommerce:acs:names:role
        value: user-r-id # NormalUser
      - id: urn:restorecommerce:acs:names:roleScopingEntity
        value: urn:restorecommerce:acs:model:organization.Organization
    resources:
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:order.Order
    actions: [ ]
  effect: PERMIT
  condition: ""
  evaluationCacheable: false
  contextQuery:
    filters: [ ]
    query: ""
  meta:
    modifiedBy: ""
    owners:
      - id: urn:restorecommerce:acs:names:ownerIndicatoryEntity
        value: urn:restorecommerce:acs:model:organization.Organization
      - id: urn:restorecommerce:acs:names:ownerInstance
        value: r-ug
---
  id: 7ccec95b94a04e08951e331fef59a9ee
  name: Order create read or modify rule
  description: Permits Order create, read or modify under an user hierarchical scope
  target:
    subjects:
      - id: urn:restorecommerce:acs:names:role
        value: user-r-id # NormalUser
      - id: urn:restorecommerce:acs:names:roleScopingEntity
        value: urn:restorecommerce:acs:model:user.User
    resources:
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:order.Order
    actions: [ ]
  effect: PERMIT
  condition: ""
  evaluationCacheable: false
  contextQuery:
    filters: [ ]
    query: ""
  meta:
    modifiedBy: ""
    owners:
      - id: urn:restorecommerce:acs:names:ownerIndicatoryEntity
        value: urn:restorecommerce:acs:model:organization.Organization
        attributes:
          - id: urn:restorecommerce:acs:names:ownerInstance
            value: r-ug
---
  id: 033ac24c43664c5c92fd32b21b92dba9
  name: Customer read rule for Organizational Scope
  description: Permits any read if the resource is under an organizational hierarchical scope
  target:
    subjects:
      - id: urn:restorecommerce:acs:names:role
        value: user-r-id # NormalUser
      - id: urn:restorecommerce:acs:names:roleScopingEntity
        value: urn:restorecommerce:acs:model:organization.Organization
    actions:
      - id: urn:oasis:names:tc:xacml:1.0:action:action-id
        value: urn:restorecommerce:acs:names:action:read
    resources:
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:customer.Customer
  effect: PERMIT
  condition: ""
  evaluationCacheable: false
  contextQuery:
    filters: [ ]
    query: ""
  meta:
    modifiedBy: ""
    owners:
      - id: urn:restorecommerce:acs:names:ownerIndicatoryEntity
        value: urn:restorecommerce:acs:model:organization.Organization
        attributes:
          - id: urn:restorecommerce:acs:names:ownerInstance
            value: r-ug
---
  id: f22c7ec8c97b4dd385364219559b07e1
  name: Customer read rule for Independent User Scope
  description: Permits any read if the resource is under an user hierarchical scope
  target:
    subjects:
      - id: urn:restorecommerce:acs:names:role
        value: user-r-id # NormalUser
      - id: urn:restorecommerce:acs:names:roleScopingEntity
        value: urn:restorecommerce:acs:model:user.User
    actions:
      - id: urn:oasis:names:tc:xacml:1.0:action:action-id
        value: urn:restorecommerce:acs:names:action:read
    resources:
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:customer.Customer
  effect: PERMIT
  condition: ""
  evaluationCacheable: false
  contextQuery:
    filters: [ ]
    query: ""
  meta:
    modifiedBy: ""
    owners:
      - id: urn:restorecommerce:acs:names:ownerIndicatoryEntity
        value: urn:restorecommerce:acs:model:organization.Organization
        attributes:
          - id: urn:restorecommerce:acs:names:ownerInstance
            value: r-ug
## Product, Manufacturer, ProductPrototype, ProductCategory, PriceGroup - Master Data
---
  id: 5b78e4a1cc034ddb8d71d46dfd9a53f7
  name: Product read rule
  description: Permits read for all users in any Organization or Independent user
  target:
    subjects:
      - id: urn:restorecommerce:acs:names:role
        value: user-r-id # NormalUser
    actions:
      - id: urn:oasis:names:tc:xacml:1.0:action:action-id
        value: urn:restorecommerce:acs:names:action:read
    resources:
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:product.Product
  effect: PERMIT
  condition: ""
  evaluationCacheable: false
  contextQuery:
    filters: [ ]
    query: ""
  meta:
    modifiedBy: ""
    owners:
      - id: urn:restorecommerce:acs:names:ownerIndicatoryEntity
        value: urn:restorecommerce:acs:model:organization.Organization
        attributes:
          - id: urn:restorecommerce:acs:names:ownerInstance
            value: r-ug
---
  id: f58d4fc3da244023a191c015b2b82786
  name: Manufacturer read rule
  description: Permits read for all users in any Organization or Independent user
  target:
    subjects:
      - id: urn:restorecommerce:acs:names:role
        value: user-r-id # NormalUser
    actions:
      - id: urn:oasis:names:tc:xacml:1.0:action:action-id
        value: urn:restorecommerce:acs:names:action:read
    resources:
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:manufacturer.Manufacturer
  effect: PERMIT
  condition: ""
  evaluationCacheable: false
  contextQuery:
    filters: [ ]
    query: ""
  meta:
    modifiedBy: ""
    owners:
      - id: urn:restorecommerce:acs:names:ownerIndicatoryEntity
        value: urn:restorecommerce:acs:model:organization.Organization
        attributes:
          - id: urn:restorecommerce:acs:names:ownerInstance
            value: r-ug
---
  id: 4840a726a1d44ee78d207fa5cc85c024
  name: ProductPrototype read rule
  description: Permits read for all users in any Organization or Independent user
  target:
    subjects:
      - id: urn:restorecommerce:acs:names:role
        value: user-r-id # NormalUser
    actions:
      - id: urn:oasis:names:tc:xacml:1.0:action:action-id
        value: urn:restorecommerce:acs:names:action:read
    resources:
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:product_prototype.ProductPrototype
  effect: PERMIT
  condition: ""
  evaluationCacheable: false
  contextQuery:
    filters: [ ]
    query: ""
  meta:
    modifiedBy: ""
    owners:
      - id: urn:restorecommerce:acs:names:ownerIndicatoryEntity
        value: urn:restorecommerce:acs:model:organization.Organization
        attributes:
          - id: urn:restorecommerce:acs:names:ownerInstance
            value: r-ug
---
  id: cafb58f0676c460f9034a697cd74b9df
  name: ProductCategory read rule
  description: Permits read for all users in any Organization or Independent user
  target:
    subjects:
      - id: urn:restorecommerce:acs:names:role
        value: user-r-id # NormalUser
    actions:
      - id: urn:oasis:names:tc:xacml:1.0:action:action-id
        value: urn:restorecommerce:acs:names:action:read
    resources:
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:product_category.ProductCategory
  effect: PERMIT
  condition: ""
  evaluationCacheable: false
  contextQuery:
    filters: [ ]
    query: ""
  meta:
    modifiedBy: ""
    owners:
      - id: urn:restorecommerce:acs:names:ownerIndicatoryEntity
        value: urn:restorecommerce:acs:model:organization.Organization
        attributes:
          - id: urn:restorecommerce:acs:names:ownerInstance
            value: r-ug
---
  id: 5eb184be7cc145c9b4b0e230d74f1937
  name: PriceGroup read rule
  description: Permits read for all users in any Organization or Independent user
  target:
    subjects:
      - id: urn:restorecommerce:acs:names:role
        value: user-r-id # NormalUser
    actions:
      - id: urn:oasis:names:tc:xacml:1.0:action:action-id
        value: urn:restorecommerce:acs:names:action:read
    resources:
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:price_group.PriceGroup
  effect: PERMIT
  condition: ""
  evaluationCacheable: false
  contextQuery:
    filters: [ ]
    query: ""
  meta:
    modifiedBy: ""
    owners:
      - id: urn:restorecommerce:acs:names:ownerIndicatoryEntity
        value: urn:restorecommerce:acs:model:organization.Organization
        attributes:
          - id: urn:restorecommerce:acs:names:ownerInstance
            value: r-ug
---
  id: 78f58e364c984b5f9945d993b64dd405
  name: Object Storage rule
  description: Allows normal user to perform CRUD on Object storage data on his organization
  target:
    subjects:
      - id: urn:restorecommerce:acs:names:role
        value: user-r-id # Normal User
      - id: urn:restorecommerce:acs:names:roleScopingEntity
        value: urn:restorecommerce:acs:model:organization.Organization
    resources:
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:ostorage.Ostorage
    actions: []
  effect: PERMIT
  condition: ""
  evaluationCacheable: false
  contextQuery:
    filters: [ ]
    query: ""
  meta:
    modifiedBy: ""
    owners:
      - id: urn:restorecommerce:acs:names:ownerIndicatoryEntity
        value: urn:restorecommerce:acs:model:organization.Organization
        attributes:
          - id: urn:restorecommerce:acs:names:ownerInstance
            value: r-ug
---
  id: 98f58e364c984b5f9945d993b64dd405
  name: Token create rule
  description: Permit create access to the token resource owned by user
  target:
    subjects:
      - id: urn:restorecommerce:acs:names:role
        value: user-r-id
    resources:
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:token.Token
    actions:
      - id: urn:oasis:names:tc:xacml:1.0:action:action-id
        value: urn:restorecommerce:acs:names:action:create
  condition:
    "
      const resources = context.resources;
      let match = false;
      let owner;
      for (let resource of resources) {
         match = false;
         if (resource && resource.meta && resource.meta.owner) {
           owner = resource.meta.owner;
         }
         for (let ownerObj of owner) {
           if (ownerObj && ownerObj.attributes.length > 0) {
             // ownerObj.id == 'urn:restorecommerce:acs:names:ownerInstance'
             for (let ownerInst of ownerObj.attributes) {
               if (ownerInst.id == 'urn:restorecommerce:acs:names:ownerInstance') {
                 if (ownerInst.value == context.subject.id) {
                   match = true;
                   break;
                 }
               }
             }
           }
         }
      }
      match;
    "
  effect: PERMIT
  evaluationCacheable: true
  meta:
    owners:
      - id: urn:restorecommerce:acs:names:ownerIndicatoryEntity
        value: urn:restorecommerce:acs:model:organization.Organization
        attributes:
          - id: urn:restorecommerce:acs:names:ownerInstance
            value: r-ug
---
  id: 99f58e364c984b5f9945d993b64dd405
  name: Token modify rule
  description: Permit modify access to the token resource owned by user
  target:
    subjects:
      - id: urn:restorecommerce:acs:names:role
        value: user-r-id
    resources:
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:token.Token
    actions:
      - id: urn:oasis:names:tc:xacml:1.0:action:action-id
        value: urn:restorecommerce:acs:names:action:modify
  condition:
    "
      const resources = context.resources;
      let match = false;
      let owner;
      for (let resource of resources) {
         match = false;
         if (resource && resource.meta && resource.meta.owner) {
           owner = resource.meta.owner;
         }
         for (let ownerObj of owner) {
           if (ownerObj && ownerObj.attributes.length > 0) {
             // ownerObj.id == 'urn:restorecommerce:acs:names:ownerInstance'
             for (let ownerInst of ownerObj.attributes) {
               if (ownerInst.id == 'urn:restorecommerce:acs:names:ownerInstance') {
                 if (ownerInst.value == context.subject.id) {
                   match = true;
                   break;
                 }
               }
             }
           }
         }
      }
      match;
    "
  effect: PERMIT
  evaluationCacheable: true
  meta:
    owners:
      - id: urn:restorecommerce:acs:names:ownerIndicatoryEntity
        value: urn:restorecommerce:acs:model:organization.Organization
        attributes:
          - id: urn:restorecommerce:acs:names:ownerInstance
            value: r-ug
---
  id: 10g58e364c984b5f9945d993b64dd405
  name: Token delete rule
  description: Permit delete access to the token resource owned by user
  target:
    subjects:
      - id: urn:restorecommerce:acs:names:role
        value: user-r-id
    resources:
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:token.Token
    actions:
      - id: urn:oasis:names:tc:xacml:1.0:action:action-id
        value: urn:restorecommerce:acs:names:action:delete
  condition:
    "
      const resources = context.resources;
      let match = false;
      let owner;
      for (let resource of resources) {
         match = false;
         if (resource && resource.meta && resource.meta.owner) {
           owner = resource.meta.owner;
         }
         for (let ownerObj of owner) {
           if (ownerObj && ownerObj.attributes.length > 0) {
             // ownerObj.id == 'urn:restorecommerce:acs:names:ownerInstance'
             for (let ownerInst of ownerObj.attributes) {
               if (ownerInst.id == 'urn:restorecommerce:acs:names:ownerInstance') {
                 if (ownerInst.value == context.subject.id) {
                   match = true;
                   break;
                 }
               }
             }
           }
         }
      }
      match;
    "
  effect: PERMIT
  evaluationCacheable: true
  meta:
    owners:
      - id: urn:restorecommerce:acs:names:ownerIndicatoryEntity
        value: urn:restorecommerce:acs:model:organization.Organization
        attributes:
          - id: urn:restorecommerce:acs:names:ownerInstance
            value: r-ug
---
  id: 11g58e364c984b5f9945d993b64dd405
  name: Token read rule
  description: Permit read access to the token resource owned by user
  target:
    subjects:
      - id: urn:restorecommerce:acs:names:role
        value: user-r-id
    resources:
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:token.Token
    actions:
      - id: urn:oasis:names:tc:xacml:1.0:action:action-id
        value: urn:restorecommerce:acs:names:action:read
  condition:
    "
      let filter = context.subject.id;
      filter;
    "
  effect: PERMIT
  evaluationCacheable: true
  meta:
    owners:
      - id: urn:restorecommerce:acs:names:ownerIndicatoryEntity
        value: urn:restorecommerce:acs:model:organization.Organization
        attributes:
          - id: urn:restorecommerce:acs:names:ownerInstance
            value: r-ug
---
  id: 98f1994dcfb24471ab29b38b527da7a4
  name: Token Admin rule
  description: Permit CRMD to token resource by admin user
  target:
    subjects:
      - id: urn:restorecommerce:acs:names:role
        value: administrator-r-id
      - id: urn:restorecommerce:acs:names:roleScopingEntity
        value: urn:restorecommerce:acs:model:organization.Organization
    resources:
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:token.Token
  effect: PERMIT
  evaluationCacheable: true
  meta:
    owners:
      - id: urn:restorecommerce:acs:names:ownerIndicatoryEntity
        value: urn:restorecommerce:acs:model:organization.Organization
        attributes:
          - id: urn:restorecommerce:acs:names:ownerInstance
            value: r-ug
---
  id: 81f58e364c984b5f9945d993b64dd405
  name: Object Storage rule for the internal bucket
  description: Allows unauthenticated-user to read Object storage data from the internal bucket
  target:
    subjects:
      - id: urn:restorecommerce:acs:names:unauthenticated-user
        value: "true"
    resources:
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:internal.Internal
    actions:
      - id: urn:oasis:names:tc:xacml:1.0:action:action-id
        value: urn:restorecommerce:acs:names:action:read
  effect: PERMIT
  meta:
    owners:
      - id: urn:restorecommerce:acs:names:ownerIndicatoryEntity
        value: urn:restorecommerce:acs:model:organization.Organization
        attributes:
          - id: urn:restorecommerce:acs:names:ownerInstance
            value: r-ug
