---
  id: fall_back_rule
  name: Fallback rule
  description: Fallback rule
  effect: DENY
  target:
    subjects:
      - id: urn:restorecommerce:acs:names:role
        value: user-r-id # NormalUser
    actions: []
    resources: []
  condition: ""
  evaluationCacheable: false
  contextQuery:
    filters: []
    query: ""
  meta:
    modifiedBy: ""
    owners:
      - id: urn:restorecommerce:acs:names:ownerIndicatoryEntity
        value: urn:restorecommerce:acs:model:organization.Organization
        attributes:
          - id: urn:restorecommerce:acs:names:ownerInstance
            value: system
---
  id: superadmin_rule
  name: SuperAdmins Rule
  description: Permit anything by SuperAdmins (fallback rule)
  target:
    subjects:
      - id: urn:restorecommerce:acs:names:role
        value: superadministrator-r-id # SuperAdmin
    actions: [ ]
    resources: [ ]
  effect: PERMIT
  condition: ""
  evaluationCacheable: false
  contextQuery:
    filters: [ ]
    query: ""
  meta:
    modifiedBy: ""
    owners:
      - id: urn:restorecommerce:acs:names:ownerIndicatoryEntity
        value: urn:restorecommerce:acs:model:organization.Organization
        attributes:
          - id: urn:restorecommerce:acs:names:ownerInstance
            value: system
---
  id: normal_user_read_rule
  name: User read rule
  description: Permits User read if he is owner of resource
  target:
    subjects:
      - id: urn:restorecommerce:acs:names:role
        value: user-r-id # NormalUser
    actions:
      - id: urn:oasis:names:tc:xacml:1.0:action:action-id
        value: urn:restorecommerce:acs:names:action:read
    resources:
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:user.User
  condition:
    "
    (request) => request?.target?.resources?.some(
      (obj) => obj?.id === 'urn:restorecommerce:acs:names:model:entity' && obj?.value === 'urn:restorecommerce:acs:model:user.User'
    ) ? request?.context?.subject?.id : undefined;
    "
  effect: PERMIT
  evaluationCacheable: false
  contextQuery:
    filters: [ ]
    query: ""
  meta:
    modifiedBy: ""
    owners:
      - id: urn:restorecommerce:acs:names:ownerIndicatoryEntity
        value: urn:restorecommerce:acs:model:organization.Organization
        attributes:
          - id: urn:restorecommerce:acs:names:ownerInstance
            value: system
---
  id: normal_user_organization_read_rule_scoped
  name: Organization read rule
  description: Permits any read if the resource is under an organizational hierarchical scope
  target:
    subjects:
      - id: urn:restorecommerce:acs:names:role
        value: user-r-id # NormalUser
      - id: urn:restorecommerce:acs:names:roleScopingEntity
        value: urn:restorecommerce:acs:model:organization.Organization
    actions:
      - id: urn:oasis:names:tc:xacml:1.0:action:action-id
        value: urn:restorecommerce:acs:names:action:read
    resources:
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:organization.Organization
  effect: PERMIT
  condition: ""
  evaluationCacheable: false
  contextQuery:
    filters: [ ]
    query: ""
  meta:
    modifiedBy: ""
    owners:
      - id: urn:restorecommerce:acs:names:ownerIndicatoryEntity
        value: urn:restorecommerce:acs:model:organization.Organization
        attributes:
          - id: urn:restorecommerce:acs:names:ownerInstance
            value: system
---
  id: normal_user_address_read_rule_scoped
  name: Address read rule
  description: Permits any read if the resource is under an organizational hierarchical scope
  target:
    subjects:
      - id: urn:restorecommerce:acs:names:role
        value: user-r-id # NormalUser
      - id: urn:restorecommerce:acs:names:roleScopingEntity
        value: urn:restorecommerce:acs:model:organization.Organization
    actions:
      - id: urn:oasis:names:tc:xacml:1.0:action:action-id
        value: urn:restorecommerce:acs:names:action:read
    resources:
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:address.Address
  effect: PERMIT
  condition: ""
  evaluationCacheable: false
  contextQuery:
    filters: [ ]
    query: ""
  meta:
    modifiedBy: ""
    owners:
      - id: urn:restorecommerce:acs:names:ownerIndicatoryEntity
        value: urn:restorecommerce:acs:model:organization.Organization
        attributes:
          - id: urn:restorecommerce:acs:names:ownerInstance
            value: system
---
  id: normal_user_contactpoint_read_rule_scoped
  name: ContactPoint read rule
  description: Permits any read if the resource is under an organizational hierarchical scope
  target:
    subjects:
      - id: urn:restorecommerce:acs:names:role
        value: user-r-id # NormalUser
      - id: urn:restorecommerce:acs:names:roleScopingEntity
        value: urn:restorecommerce:acs:model:organization.Organization
    actions:
      - id: urn:oasis:names:tc:xacml:1.0:action:action-id
        value: urn:restorecommerce:acs:names:action:read
    resources:
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:contact_point.ContactPoint
  effect: PERMIT
  condition: ""
  evaluationCacheable: false
  contextQuery:
    filters: [ ]
    query: ""
  meta:
    modifiedBy: ""
    owners:
      - id: urn:restorecommerce:acs:names:ownerIndicatoryEntity
        value: urn:restorecommerce:acs:model:organization.Organization
        attributes:
          - id: urn:restorecommerce:acs:names:ownerInstance
            value: system
---
  id: normal_user_contactpoint_type_read_rule
  name: ContactPointType read rule
  description: Permits read for all users in any Organization
  target:
    subjects:
      - id: urn:restorecommerce:acs:names:role
        value: user-r-id # NormalUser
    actions:
      - id: urn:oasis:names:tc:xacml:1.0:action:action-id
        value: urn:restorecommerce:acs:names:action:read
    resources:
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:contact_point_type.ContactPointType
  effect: PERMIT
  condition: ""
  evaluationCacheable: false
  contextQuery:
    filters: [ ]
    query: ""
  meta:
    modifiedBy: ""
    owners:
      - id: urn:restorecommerce:acs:names:ownerIndicatoryEntity
        value: urn:restorecommerce:acs:model:organization.Organization
        attributes:
          - id: urn:restorecommerce:acs:names:ownerInstance
            value: system
---
  id: normal_user_locale_read_rule
  name: Locale read rule
  description: Permits read for all users in any Organization
  target:
    subjects:
      - id: urn:restorecommerce:acs:names:role
        value: user-r-id # NormalUser
    actions:
      - id: urn:oasis:names:tc:xacml:1.0:action:action-id
        value: urn:restorecommerce:acs:names:action:read
    resources:
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:locale.Locale
  effect: PERMIT
  condition: ""
  evaluationCacheable: false
  contextQuery:
    filters: [ ]
    query: ""
  meta:
    modifiedBy: ""
    owners:
      - id: urn:restorecommerce:acs:names:ownerIndicatoryEntity
        value: urn:restorecommerce:acs:model:organization.Organization
        attributes:
          - id: urn:restorecommerce:acs:names:ownerInstance
            value: system
---
  id: normal_user_timezone_read_rule
  name: Timezone read rule
  description: Permits read for all users
  target:
    subjects:
      - id: urn:restorecommerce:acs:names:role
        value: user-r-id # NormalUser
    actions:
      - id: urn:oasis:names:tc:xacml:1.0:action:action-id
        value: urn:restorecommerce:acs:names:action:read
    resources:
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:timezone.Timezone
  effect: PERMIT
  condition: ""
  evaluationCacheable: false
  contextQuery:
    filters: [ ]
    query: ""
  meta:
    modifiedBy: ""
    owners:
      - id: urn:restorecommerce:acs:names:ownerIndicatoryEntity
        value: urn:restorecommerce:acs:model:organization.Organization
        attributes:
          - id: urn:restorecommerce:acs:names:ownerInstance
            value: system
---
  id: normal_user_roles_read_rule
  name: Role read rule
  description: Only Admin should be allowed to read all Roles in system
  target:
    subjects:
      - id: urn:restorecommerce:acs:names:role
        value: user-r-id # NormalUser
      - id: urn:restorecommerce:acs:names:role
        value: administrator-r-id # Admin
    actions:
      - id: urn:oasis:names:tc:xacml:1.0:action:action-id
        value: urn:restorecommerce:acs:names:action:read
    resources:
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:role.Role
  effect: PERMIT
  condition: ""
  evaluationCacheable: false
  contextQuery:
    filters: [ ]
    query: ""
  meta:
    modifiedBy: ""
    owners:
      - id: urn:restorecommerce:acs:names:ownerIndicatoryEntity
        value: urn:restorecommerce:acs:model:organization.Organization
        attributes:
          - id: urn:restorecommerce:acs:names:ownerInstance
            value: system
---
  id: superadmin_role_read_rule
  name: Role SuperAdmin read rule
  description: SuperAdmin role should not be readable
  target:
    subjects:
      - id: urn:restorecommerce:acs:names:role
        value: user-r-id # NormalUser
    actions:
      - id: urn:oasis:names:tc:xacml:1.0:action:action-id
        value: urn:restorecommerce:acs:names:action:read
    resources:
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:role.Role
      - id: urn:oasis:names:tc:xacml:1.0:resource:resource-id
        value: superadministrator-r-id
  effect: DENY
  condition: ""
  evaluationCacheable: false
  contextQuery:
    filters: [ ]
    query: ""
  meta:
    modifiedBy: ""
    owners:
      - id: urn:restorecommerce:acs:names:ownerIndicatoryEntity
        value: urn:restorecommerce:acs:model:organization.Organization
        attributes:
          - id: urn:restorecommerce:acs:names:ownerInstance
            value: system
---
  id: normal_user_tax_read_rule
  name: Tax read rule
  description: Permits read for all users in any Organization
  target:
    subjects:
      - id: urn:restorecommerce:acs:names:role
        value: user-r-id # NormalUser
    actions:
      - id: urn:oasis:names:tc:xacml:1.0:action:action-id
        value: urn:restorecommerce:acs:names:action:read
    resources:
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:tax.Tax
  effect: PERMIT
  condition: ""
  evaluationCacheable: false
  contextQuery:
    filters: [ ]
    query: ""
  meta:
    modifiedBy: ""
    owners:
      - id: urn:restorecommerce:acs:names:ownerIndicatoryEntity
        value: urn:restorecommerce:acs:model:organization.Organization
        attributes:
          - id: urn:restorecommerce:acs:names:ownerInstance
            value: system
---
  id: normal_user_tax_type_read_rule
  name: TaxType read rule
  description: Permits read for all users in any Organization
  target:
    subjects:
      - id: urn:restorecommerce:acs:names:role
        value: user-r-id # NormalUser
    actions:
      - id: urn:oasis:names:tc:xacml:1.0:action:action-id
        value: urn:restorecommerce:acs:names:action:read
    resources:
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:tax_type.TaxType
  effect: PERMIT
  condition: ""
  evaluationCacheable: false
  contextQuery:
    filters: [ ]
    query: ""
  meta:
    modifiedBy: ""
    owners:
      - id: urn:restorecommerce:acs:names:ownerIndicatoryEntity
        value: urn:restorecommerce:acs:model:organization.Organization
        attributes:
          - id: urn:restorecommerce:acs:names:ownerInstance
            value: system
---
  id: normal_user_country_read_rule
  name: Country read rule
  description: Permits read for all users in any Organization
  target:
    subjects:
      - id: urn:restorecommerce:acs:names:role
        value: user-r-id # NormalUser
    actions:
      - id: urn:oasis:names:tc:xacml:1.0:action:action-id
        value: urn:restorecommerce:acs:names:action:read
    resources:
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:country.Country
  effect: PERMIT
  condition: ""
  evaluationCacheable: false
  contextQuery:
    filters: [ ]
    query: ""
  meta:
    modifiedBy: ""
    owners:
      - id: urn:restorecommerce:acs:names:ownerIndicatoryEntity
        value: urn:restorecommerce:acs:model:organization.Organization
        attributes:
          - id: urn:restorecommerce:acs:names:ownerInstance
            value: system
---
  id: register_user_rule
  name: Register User rule
  description: Targets register
  target:
    subjects:
      - id: urn:restorecommerce:acs:names:unauthenticated-user
        value: "true"
    actions:
      - id: urn:oasis:names:tc:xacml:1.0:action:action-id
        value: urn:restorecommerce:acs:names:action:create
    resources:
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:user.User
  effect: PERMIT
  condition: ""
  evaluationCacheable: false
  contextQuery:
    filters: [ ]
    query: ""
  meta:
    modifiedBy: ""
    owners:
      - id: urn:restorecommerce:acs:names:ownerIndicatoryEntity
        value: urn:restorecommerce:acs:model:organization.Organization
        attributes:
          - id: urn:restorecommerce:acs:names:ownerInstance
            value: system
---
  id: forgot_password_rule
  name: User 'Forgot Password' rule
  description: Permits 'modify' by unauthenticated users on their password
  target:
    subjects:
      - id: urn:restorecommerce:acs:names:unauthenticated-user
        value: "true"
    actions:
      - id: urn:oasis:names:tc:xacml:1.0:action:action-id
        value: urn:restorecommerce:acs:names:action:modify
    resources:
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:user.User
      - id: urn:restorecommerce:acs:names:model:property
        value: urn:restorecommerce:acs:model:user.User#activation_code
      - id: urn:restorecommerce:acs:names:model:property
        value: urn:restorecommerce:acs:model:user.User#password_hash
  effect: PERMIT
  condition: ""
  evaluationCacheable: false
  contextQuery:
    filters: [ ]
    query: ""
  meta:
    modifiedBy: ""
    owners:
      - id: urn:restorecommerce:acs:names:ownerIndicatoryEntity
        value: urn:restorecommerce:acs:model:organization.Organization
        attributes:
          - id: urn:restorecommerce:acs:names:ownerInstance
            value: system
---
  id: confirm_email_change_rule
  name: User 'ConfirmEmailChange' rule
  description: Permits 'modify' by unauthenticated users on their password
  target:
    subjects:
      - id: urn:restorecommerce:acs:names:unauthenticated-user
        value: "true"
    actions:
      - id: urn:oasis:names:tc:xacml:1.0:action:action-id
        value: urn:restorecommerce:acs:names:action:modify
    resources:
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:user.User
      - id: urn:restorecommerce:acs:names:model:property
        value: urn:restorecommerce:acs:model:user.User#activation_code
      - id: urn:restorecommerce:acs:names:model:property
        value: urn:restorecommerce:acs:model:user.User#email
  effect: PERMIT
  condition: ""
  evaluationCacheable: false
  contextQuery:
    filters: [ ]
    query: ""
  meta:
    modifiedBy: ""
    owners:
      - id: urn:restorecommerce:acs:names:ownerIndicatoryEntity
        value: urn:restorecommerce:acs:model:organization.Organization
        attributes:
          - id: urn:restorecommerce:acs:names:ownerInstance
            value: system
---
  id: user_activation_rule
  name: User Activation
  description: Permits 'modify' by unauthenticated users in case of activation
  target:
    subjects:
      - id: urn:restorecommerce:acs:names:unauthenticated-user
        value: "true"
    actions:
      - id: urn:oasis:names:tc:xacml:1.0:action:action-id
        value: urn:restorecommerce:acs:names:action:modify
    resources:
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:user.User
      - id: urn:restorecommerce:acs:names:model:property
        value: urn:restorecommerce:acs:model:user.User#active
      - id: urn:restorecommerce:acs:names:model:property
        value: urn:restorecommerce:acs:model:user.User#activation_code
  effect: PERMIT
  condition: ""
  evaluationCacheable: false
  contextQuery:
    filters: [ ]
    query: ""
  meta:
    modifiedBy: ""
    owners:
      - id: urn:restorecommerce:acs:names:ownerIndicatoryEntity
        value: urn:restorecommerce:acs:model:organization.Organization
        attributes:
          - id: urn:restorecommerce:acs:names:ownerInstance
            value: system
---
  id: normal_user_account_rule
  name: User Account Rule
  description: Permits actions by any User on its own account data
  target:
    subjects:
      - id: urn:restorecommerce:acs:names:role
        value: user-r-id # Normal User
    resources:
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:user.User
    actions: []
  condition: # target.resources -> will contain the subject id of the requestor
    "
      (request) => {
        let isUser = false;
        let match = false;
        isUser = request?.target?.resources?.some((obj) => obj?.id == 'urn:restorecommerce:acs:names:model:entity' && obj?.value == 'urn:restorecommerce:acs:model:user.User');
        if (isUser) {
          match = request?.target?.resources?.some((obj) => obj?.id == 'urn:oasis:names:tc:xacml:1.0:resource:resource-id' && obj?.value == request?.context?.subject?.id);
        }
        return match;
      }
    "
  effect: PERMIT
  evaluationCacheable: false
  contextQuery:
    filters: [ ]
    query: ""
  meta:
    modifiedBy: ""
    owners:
      - id: urn:restorecommerce:acs:names:ownerIndicatoryEntity
        value: urn:restorecommerce:acs:model:organization.Organization
        attributes:
          - id: urn:restorecommerce:acs:names:ownerInstance
            value: system
---
  id: administrator_rule
  name: Admin Rule
  description: Permits all if subject is Admin within the resource's hierarchical scope
  target:
    subjects:
      - id: urn:restorecommerce:acs:names:role
        value: administrator-r-id # Admin
      - id: urn:restorecommerce:acs:names:roleScopingEntity
        value: urn:restorecommerce:acs:model:organization.Organization
    actions: []
    resources: []
  effect: PERMIT
  condition: ""
  evaluationCacheable: false
  contextQuery:
    filters: [ ]
    query: ""
  meta:
    modifiedBy: ""
    owners:
      - id: urn:restorecommerce:acs:names:ownerIndicatoryEntity
        value: urn:restorecommerce:acs:model:organization.Organization
        attributes:
          - id: urn:restorecommerce:acs:names:ownerInstance
            value: system
# Special Rules
---
  id: delete_organization_rule
  name: DeleteOrg Rule
  description: Rule targeting the `DeleteOrgData` mutation
  target:
    resources:
      - id: urn:restorecommerce:acs:names:operation
        value: mutation.deleteOrgData
    actions:
      - id: urn:oasis:names:tc:xacml:1.0:action:action-id
        value: urn:restorecommerce:acs:names:action:execute
    subjects:
      - id: urn:restorecommerce:acs:names:role
        value: superadministrator-r-id # SuperAdmin
  effect: PERMIT
  condition: ""
  evaluationCacheable: false
  contextQuery:
    filters: [ ]
    query: ""
  meta:
    modifiedBy: ""
    owners:
      - id: urn:restorecommerce:acs:names:ownerIndicatoryEntity
        value: urn:restorecommerce:acs:model:organization.Organization
        attributes:
          - id: urn:restorecommerce:acs:names:ownerInstance
            value: system
---
  id: execute_command_rule
  name: ExecuteCommand Rule
  description: Targets the `ExecuteCommand` mutation
  target:
    resources:
      - id: urn:restorecommerce:acs:names:operation
        value: mutation.executeCommand
    actions:
      - id: urn:oasis:names:tc:xacml:1.0:action:action-id
        value: urn:restorecommerce:acs:names:action:execute
    subjects:
      - id: urn:restorecommerce:acs:names:role
        value: superadministrator-r-id # SuperAdmin
  effect: PERMIT
  condition: ""
  evaluationCacheable: false
  contextQuery:
    filters: [ ]
    query: ""
  meta:
    
    modifiedBy: ""
    owners:
      - id: urn:restorecommerce:acs:names:ownerIndicatoryEntity
        value: urn:restorecommerce:acs:model:organization.Organization
        attributes:
          - id: urn:restorecommerce:acs:names:ownerInstance
            value: system
---
  id: org_scoped_order_read_rule
  name: Order read rule for scoped Organization
  description: Permits Order read under an organizational hierarchical scope
  target:
    subjects:
      - id: urn:restorecommerce:acs:names:role
        value: user-r-id # NormalUser
      - id: urn:restorecommerce:acs:names:roleScopingEntity
        value: urn:restorecommerce:acs:model:organization.Organization
    actions:
      - id: urn:oasis:names:tc:xacml:1.0:action:action-id
        value: urn:restorecommerce:acs:names:action:read
    resources:
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:order.Order
  effect: PERMIT
  condition: ""
  evaluationCacheable: false
  contextQuery:
    filters: [ ]
    query: ""
  meta:
    modifiedBy: ""
    owners:
      - id: urn:restorecommerce:acs:names:ownerIndicatoryEntity
        value: urn:restorecommerce:acs:model:organization.Organization
        attributes:
          - id: urn:restorecommerce:acs:names:ownerInstance
            value: system
---
  id: org_scoped_order_modify_rule
  name: Order create or modify rule for scoped Organization
  description: Permits Order create or modify under condition and organizational hierarchical scope
  target:
    subjects:
      - id: urn:restorecommerce:acs:names:role
        value: user-r-id # NormalUser
      - id: urn:restorecommerce:acs:names:roleScopingEntity
        value: urn:restorecommerce:acs:model:organization.Organization
    actions:
      - id: urn:oasis:names:tc:xacml:1.0:action:action-id
        value: urn:restorecommerce:acs:names:action:modify
    resources:
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:order.Order
  effect: PERMIT
  # NormalUser can only create or modify orders of no higher state than CREATED
  condition:
    "
    (request) => request?.context?.resources?.length === 0 || request?.context?.resources?.every(
      resource => !resource.order_state
        || resource.order_state?.toString() === 'UNRECOGNIZED'
        || resource.order_state?.toString() === 'CREATED'
    );
    "
  evaluationCacheable: false
  contextQuery:
    filters: [ ]
    query: ""
  meta:
    modifiedBy: ""
    owners:
      - id: urn:restorecommerce:acs:names:ownerIndicatoryEntity
        value: urn:restorecommerce:acs:model:organization.Organization
        attributes:
          - id: urn:restorecommerce:acs:names:ownerInstance
            value: system
---
  id: org_scoped_order_delete_rule
  name: Order delete rule for scoped Organization
  description: Permits Order delete under condition and organizational hierarchical scope
  target:
    subjects:
      - id: urn:restorecommerce:acs:names:role
        value: user-r-id # NormalUser
      - id: urn:restorecommerce:acs:names:roleScopingEntity
        value: urn:restorecommerce:acs:model:organization.Organization
    actions:
      - id: urn:oasis:names:tc:xacml:1.0:action:action-id
        value: urn:restorecommerce:acs:names:action:delete
    resources:
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:order.Order
  effect: PERMIT
  # NormalUser can only delete orders of no higher state than CREATED
  condition:
    "
    (request) => request?.context?.resources?.length === 0 || request?.context?.resources?.every(
      resource => !resource.order_state
        || resource.order_state?.toString() === 'UNRECOGNIZED'
        || resource.order_state?.toString() === 'CREATED'
    );
    "
  evaluationCacheable: false
  contextQuery:
    filters: [ ]
    query: ""
  meta:
    modifiedBy: ""
    owners:
      - id: urn:restorecommerce:acs:names:ownerIndicatoryEntity
        value: urn:restorecommerce:acs:model:organization.Organization
        attributes:
          - id: urn:restorecommerce:acs:names:ownerInstance
            value: system
---
  id: org_scoped_order_submit_rule
  name: Order submit rule for scoped Organization
  description: Permits Order submit under condition and organizational hierarchical scope
  target:
    subjects:
      - id: urn:restorecommerce:acs:names:role
        value: user-r-id # NormalUser
      - id: urn:restorecommerce:acs:names:roleScopingEntity
        value: urn:restorecommerce:acs:model:organization.Organization
    actions:
      - id: urn:oasis:names:tc:xacml:1.0:action:action-id
        value: urn:restorecommerce:acs:names:action:execute
    resources:
      - id: urn:restorecommerce:acs:names:operation
        value: execution.submitOrders
  effect: PERMIT
  # NormalUser can only submit orders of no higher state than CREATED
  condition:
    "
    (request) => request?.context?.resources?.every(
      resource => resource.user_id === request.subject?.id && (
        !resource.order_state
        || resource.order_state?.toString() === 'UNRECOGNIZED'
        || resource.order_state?.toString() === 'CREATED'
        )
    );
    "
  evaluationCacheable: false
  contextQuery:
    filters: [ ]
    query: ""
  meta:
    modifiedBy: ""
    owners:
      - id: urn:restorecommerce:acs:names:ownerIndicatoryEntity
        value: urn:restorecommerce:acs:model:organization.Organization
        attributes:
          - id: urn:restorecommerce:acs:names:ownerInstance
            value: system
---
  id: org_scoped_order_withdraw_rule
  name: Order withdraw rule for scoped Organization
  description: Permits Order withdraw under condition and organizational hierarchical scope
  target:
    subjects:
      - id: urn:restorecommerce:acs:names:role
        value: user-r-id # NormalUser
      - id: urn:restorecommerce:acs:names:roleScopingEntity
        value: urn:restorecommerce:acs:model:organization.Organization
    actions:
      - id: urn:oasis:names:tc:xacml:1.0:action:action-id
        value: urn:restorecommerce:acs:names:action:execute
    resources:
      - id: urn:restorecommerce:acs:names:operation
        value: execution.withdrawOrders
  effect: PERMIT
  # NormalUser can only withdraw SUBMITTED orders
  condition:
    "
    (request) => request?.context?.resources?.every(
      resource => resource.user_id === request.subject?.id
        && resource.order_state?.toString() === 'SUBMITTED'
    );
    "
  evaluationCacheable: false
  contextQuery:
    filters: [ ]
    query: ""
  meta:
    modifiedBy: ""
    owners:
      - id: urn:restorecommerce:acs:names:ownerIndicatoryEntity
        value: urn:restorecommerce:acs:model:organization.Organization
        attributes:
          - id: urn:restorecommerce:acs:names:ownerInstance
            value: system
---
  id: user_scoped_order_read_rule
  name: Order read rule for scoped User
  description: Permits Order read under user scope
  target:
    subjects:
      - id: urn:restorecommerce:acs:names:role
        value: user-r-id # NormalUser
      - id: urn:restorecommerce:acs:names:roleScopingEntity
        value: urn:restorecommerce:acs:model:user.User
    actions:
      - id: urn:oasis:names:tc:xacml:1.0:action:action-id
        value: urn:restorecommerce:acs:names:action:read
    resources:
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:order.Order
  effect: PERMIT
  condition: ""
  evaluationCacheable: false
  contextQuery:
    filters: [ ]
    query: ""
  meta:
    modifiedBy: ""
    owners:
      - id: urn:restorecommerce:acs:names:ownerIndicatoryEntity
        value: urn:restorecommerce:acs:model:organization.Organization
        attributes:
          - id: urn:restorecommerce:acs:names:ownerInstance
            value: system
---
  id: user_scoped_order_modify_rule
  name: Order create or modify rule for scoped User
  description: Permits Order create or modify under condition and user scope
  target:
    subjects:
      - id: urn:restorecommerce:acs:names:role
        value: user-r-id # NormalUser
      - id: urn:restorecommerce:acs:names:roleScopingEntity
        value: urn:restorecommerce:acs:model:user.User
    actions:
      - id: urn:oasis:names:tc:xacml:1.0:action:action-id
        value: urn:restorecommerce:acs:names:action:modify
    resources:
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:order.Order
  effect: PERMIT
  # NormalUser can only create or modify orders of no higher state than CREATED
  condition:
    "
    (request) => request?.context?.resources?.every(
      resource => resource.user_id === request.subject?.id
        && (
          !resource.order_state
          || resource.order_state?.toString() === 'UNRECOGNIZED'
          || resource.order_state?.toString() === 'CREATED'
        )
    );
    "
  evaluationCacheable: false
  contextQuery:
    filters: [ ]
    query: ""
  meta:
    modifiedBy: ""
    owners:
      - id: urn:restorecommerce:acs:names:ownerIndicatoryEntity
        value: urn:restorecommerce:acs:model:organization.Organization
        attributes:
          - id: urn:restorecommerce:acs:names:ownerInstance
            value: system
---
  id: user_scoped_order_delete_rule
  name: Order delete rule for scoped User
  description: Permits Order delete under condition and user scope
  target:
    subjects:
      - id: urn:restorecommerce:acs:names:role
        value: user-r-id # NormalUser
      - id: urn:restorecommerce:acs:names:roleScopingEntity
        value: urn:restorecommerce:acs:model:user.User
    actions:
      - id: urn:oasis:names:tc:xacml:1.0:action:action-id
        value: urn:restorecommerce:acs:names:action:delete
    resources:
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:order.Order
  effect: PERMIT
  # NormalUser can only delete orders of no higher state than CREATED
  condition:
    "
    (request) => request?.context?.resources?.every(
      resource => resource.user_id === request.subject?.id
        && (
          !resource.order_state
          || resource.order_state?.toString() === 'UNRECOGNIZED'
          || resource.order_state?.toString() === 'CREATED'
        )
    );
    "
  evaluationCacheable: false
  contextQuery:
    filters: [ ]
    query: ""
  meta:
    modifiedBy: ""
    owners:
      - id: urn:restorecommerce:acs:names:ownerIndicatoryEntity
        value: urn:restorecommerce:acs:model:organization.Organization
        attributes:
          - id: urn:restorecommerce:acs:names:ownerInstance
            value: system
---
  id: user_scoped_order_submit_rule
  name: Order submit rule for scoped User
  description: Permits Order submit under condition and user scope
  target:
    subjects:
      - id: urn:restorecommerce:acs:names:role
        value: user-r-id # NormalUser
      - id: urn:restorecommerce:acs:names:roleScopingEntity
        value: urn:restorecommerce:acs:model:user.User
    actions:
      - id: urn:oasis:names:tc:xacml:1.0:action:action-id
        value: urn:restorecommerce:acs:names:action:execute
    resources:
      - id: urn:restorecommerce:acs:names:operation
        value: execution.submitOrders
  effect: PERMIT
  # NormalUser can only submit orders of no higher state than CREATED
  condition:
    "
    (request) => request?.context?.resources?.every(
      resource => resource.user_id === request.subject?.id
        && (
          !resource.order_state
          || resource.order_state?.toString() === 'UNRECOGNIZED'
          || resource.order_state?.toString() === 'CREATED'
        )
    );
    "
  evaluationCacheable: false
  contextQuery:
    filters: [ ]
    query: ""
  meta:
    modifiedBy: ""
    owners:
      - id: urn:restorecommerce:acs:names:ownerIndicatoryEntity
        value: urn:restorecommerce:acs:model:organization.Organization
        attributes:
          - id: urn:restorecommerce:acs:names:ownerInstance
            value: system
---
  id: user_scoped_order_withdraw_rule
  name: Order withdraw rule for scoped User
  description: Permits Order withdraw under condition and users hierarchical scope
  target:
    subjects:
      - id: urn:restorecommerce:acs:names:role
        value: user-r-id # NormalUser
      - id: urn:restorecommerce:acs:names:roleScopingEntity
        value: urn:restorecommerce:acs:model:user.User
    resources:
      - id: urn:restorecommerce:acs:names:operation
        value: execution.withdrawOrders
  effect: PERMIT
  # NormalUser can only withdraw SUBMITTED orders
  condition:
    "
    (request) => request?.context?.resources?.every(
      resource => resource.user_id === request.subject?.id
        && resource.order_state?.toString() === 'SUBMITTED'
    );
    "
  evaluationCacheable: false
  contextQuery:
    filters: [ ]
    query: ""
  meta:
    modifiedBy: ""
    owners:
      - id: urn:restorecommerce:acs:names:ownerIndicatoryEntity
        value: urn:restorecommerce:acs:model:organization.Organization
        attributes:
          - id: urn:restorecommerce:acs:names:ownerInstance
            value: system
---
  id: unauth_user_order_submit_rule
  name: Order submit rule for scoped unauthenticated User
  description: Permits Order submit under condition for unauthenticated Users
  target:
    subjects:
      - id: urn:restorecommerce:acs:names:unauthenticated-user
        value: "true"
    resources:
      - id: urn:restorecommerce:acs:names:operation
        value: execution.submitOrders
  effect: PERMIT
  # NormalUser can only submit orders of no higher state than CREATED
  condition: ""
  evaluationCacheable: false
  contextQuery:
    filters: [ ]
    query: ""
  meta:
    modifiedBy: ""
    owners:
      - id: urn:restorecommerce:acs:names:ownerIndicatoryEntity
        value: urn:restorecommerce:acs:model:organization.Organization
        attributes:
          - id: urn:restorecommerce:acs:names:ownerInstance
            value: system
---
  id: org_scoped_customer_read_rule
  name: Customer read rule for Organizational Scope
  description: Permits any read if the resource is under an organizational hierarchical scope
  target:
    subjects:
      - id: urn:restorecommerce:acs:names:role
        value: user-r-id # NormalUser
      - id: urn:restorecommerce:acs:names:roleScopingEntity
        value: urn:restorecommerce:acs:model:organization.Organization
    actions:
      - id: urn:oasis:names:tc:xacml:1.0:action:action-id
        value: urn:restorecommerce:acs:names:action:read
    resources:
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:customer.Customer
  effect: PERMIT
  condition: ""
  evaluationCacheable: false
  contextQuery:
    filters: [ ]
    query: ""
  meta:
    modifiedBy: ""
    owners:
      - id: urn:restorecommerce:acs:names:ownerIndicatoryEntity
        value: urn:restorecommerce:acs:model:organization.Organization
        attributes:
          - id: urn:restorecommerce:acs:names:ownerInstance
            value: system
---
  id: user_scoped_customer_read_rule
  name: Customer read rule for Independent User Scope
  description: Permits any read if the resource is under an user hierarchical scope
  target:
    subjects:
      - id: urn:restorecommerce:acs:names:role
        value: user-r-id # NormalUser
      - id: urn:restorecommerce:acs:names:roleScopingEntity
        value: urn:restorecommerce:acs:model:user.User
    actions:
      - id: urn:oasis:names:tc:xacml:1.0:action:action-id
        value: urn:restorecommerce:acs:names:action:read
    resources:
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:customer.Customer
  effect: PERMIT
  condition: ""
  evaluationCacheable: false
  contextQuery:
    filters: [ ]
    query: ""
  meta:
    modifiedBy: ""
    owners:
      - id: urn:restorecommerce:acs:names:ownerIndicatoryEntity
        value: urn:restorecommerce:acs:model:organization.Organization
        attributes:
          - id: urn:restorecommerce:acs:names:ownerInstance
            value: system
---
  id: org_scoped_shop_read_rule
  name: Shop read rule for Organizational Scope
  description: Permits any read if the resource is under an organizational hierarchical scope
  target:
    subjects:
      - id: urn:restorecommerce:acs:names:role
        value: user-r-id # NormalUser
      - id: urn:restorecommerce:acs:names:roleScopingEntity
        value: urn:restorecommerce:acs:model:organization.Organization
    actions:
      - id: urn:oasis:names:tc:xacml:1.0:action:action-id
        value: urn:restorecommerce:acs:names:action:read
    resources:
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:shop.Shop
  effect: PERMIT
  condition: ""
  evaluationCacheable: false
  contextQuery:
    filters: [ ]
    query: ""
  meta:
    modifiedBy: ""
    owners:
      - id: urn:restorecommerce:acs:names:ownerIndicatoryEntity
        value: urn:restorecommerce:acs:model:organization.Organization
        attributes:
          - id: urn:restorecommerce:acs:names:ownerInstance
            value: system
---
  id: user_scoped_shop_read_rule
  name: Shop read rule for Independent User Scope
  description: Permits any read if the resource is under an user hierarchical scope
  target:
    subjects:
      - id: urn:restorecommerce:acs:names:role
        value: user-r-id # NormalUser
      - id: urn:restorecommerce:acs:names:roleScopingEntity
        value: urn:restorecommerce:acs:model:user.User
    actions:
      - id: urn:oasis:names:tc:xacml:1.0:action:action-id
        value: urn:restorecommerce:acs:names:action:read
    resources:
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:shop.Shop
  effect: PERMIT
  condition: ""
  evaluationCacheable: false
  contextQuery:
    filters: [ ]
    query: ""
  meta:
    modifiedBy: ""
    owners:
      - id: urn:restorecommerce:acs:names:ownerIndicatoryEntity
        value: urn:restorecommerce:acs:model:organization.Organization
        attributes:
          - id: urn:restorecommerce:acs:names:ownerInstance
            value: system
---
  id: normal_user_product_read_rule
  name: Product read rule
  description: Permits read for all users in any Organization or Independent user
  target:
    subjects:
      - id: urn:restorecommerce:acs:names:role
        value: user-r-id # NormalUser
    actions:
      - id: urn:oasis:names:tc:xacml:1.0:action:action-id
        value: urn:restorecommerce:acs:names:action:read
    resources:
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:product.Product
  effect: PERMIT
  condition: ""
  evaluationCacheable: false
  contextQuery:
    filters: [ ]
    query: ""
  meta:
    modifiedBy: ""
    owners:
      - id: urn:restorecommerce:acs:names:ownerIndicatoryEntity
        value: urn:restorecommerce:acs:model:organization.Organization
        attributes:
          - id: urn:restorecommerce:acs:names:ownerInstance
            value: system
---
  id: normal_user_manufacturer_read_rule
  name: Manufacturer read rule
  description: Permits read for all users in any Organization or Independent user
  target:
    subjects:
      - id: urn:restorecommerce:acs:names:role
        value: user-r-id # NormalUser
    actions:
      - id: urn:oasis:names:tc:xacml:1.0:action:action-id
        value: urn:restorecommerce:acs:names:action:read
    resources:
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:manufacturer.Manufacturer
  effect: PERMIT
  condition: ""
  evaluationCacheable: false
  contextQuery:
    filters: [ ]
    query: ""
  meta:
    modifiedBy: ""
    owners:
      - id: urn:restorecommerce:acs:names:ownerIndicatoryEntity
        value: urn:restorecommerce:acs:model:organization.Organization
        attributes:
          - id: urn:restorecommerce:acs:names:ownerInstance
            value: system
---
  id: normal_user_product_prototype_read_rule
  name: ProductPrototype read rule
  description: Permits read for all users in any Organization or Independent user
  target:
    subjects:
      - id: urn:restorecommerce:acs:names:role
        value: user-r-id # NormalUser
    actions:
      - id: urn:oasis:names:tc:xacml:1.0:action:action-id
        value: urn:restorecommerce:acs:names:action:read
    resources:
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:product_prototype.ProductPrototype
  effect: PERMIT
  condition: ""
  evaluationCacheable: false
  contextQuery:
    filters: [ ]
    query: ""
  meta:
    modifiedBy: ""
    owners:
      - id: urn:restorecommerce:acs:names:ownerIndicatoryEntity
        value: urn:restorecommerce:acs:model:organization.Organization
        attributes:
          - id: urn:restorecommerce:acs:names:ownerInstance
            value: system
---
  id: normal_user_product_category_read_rule
  name: ProductCategory read rule
  description: Permits read for all users in any Organization or Independent user
  target:
    subjects:
      - id: urn:restorecommerce:acs:names:role
        value: user-r-id # NormalUser
    actions:
      - id: urn:oasis:names:tc:xacml:1.0:action:action-id
        value: urn:restorecommerce:acs:names:action:read
    resources:
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:product_category.ProductCategory
  effect: PERMIT
  condition: ""
  evaluationCacheable: false
  contextQuery:
    filters: [ ]
    query: ""
  meta:
    modifiedBy: ""
    owners:
      - id: urn:restorecommerce:acs:names:ownerIndicatoryEntity
        value: urn:restorecommerce:acs:model:organization.Organization
        attributes:
          - id: urn:restorecommerce:acs:names:ownerInstance
            value: system
---
  id: normal_user_price_group_read_rule
  name: PriceGroup read rule
  description: Permits read for all users in any Organization or Independent user
  target:
    subjects:
      - id: urn:restorecommerce:acs:names:role
        value: user-r-id # NormalUser
    actions:
      - id: urn:oasis:names:tc:xacml:1.0:action:action-id
        value: urn:restorecommerce:acs:names:action:read
    resources:
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:price_group.PriceGroup
  effect: PERMIT
  condition: ""
  evaluationCacheable: false
  contextQuery:
    filters: [ ]
    query: ""
  meta:
    modifiedBy: ""
    owners:
      - id: urn:restorecommerce:acs:names:ownerIndicatoryEntity
        value: urn:restorecommerce:acs:model:organization.Organization
        attributes:
          - id: urn:restorecommerce:acs:names:ownerInstance
            value: system
---
  id: normal_user_ostorage_bucket_rule_scoped
  name: Object Storage rule
  description: Allows normal user to perform CRUD on Object storage data on his organization
  target:
    subjects:
      - id: urn:restorecommerce:acs:names:role
        value: user-r-id # Normal User
      - id: urn:restorecommerce:acs:names:roleScopingEntity
        value: urn:restorecommerce:acs:model:organization.Organization
    resources:
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:ostorage.Ostorage
    actions: []
  effect: PERMIT
  condition: ""
  evaluationCacheable: false
  contextQuery:
    filters: [ ]
    query: ""
  meta:
    modifiedBy: ""
    owners:
      - id: urn:restorecommerce:acs:names:ownerIndicatoryEntity
        value: urn:restorecommerce:acs:model:organization.Organization
        attributes:
          - id: urn:restorecommerce:acs:names:ownerInstance
            value: system
---
  id: normal_user_token_create_rule_condition
  name: Token create rule
  description: Permit create access to the token resource owned by user
  target:
    subjects:
      - id: urn:restorecommerce:acs:names:role
        value: user-r-id
    resources:
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:token.Token
    actions:
      - id: urn:oasis:names:tc:xacml:1.0:action:action-id
        value: urn:restorecommerce:acs:names:action:create
  condition:
    "
     (request) => request?.context?.resources?.every(
        resource => resource?.meta?.owners?.some(
          owner => owner?.attributes?.some(
            attr => attr?.id === 'urn:restorecommerce:acs:names:ownerInstance' && attr?.value === request?.context.subject.id
          )
        )
      );
    "
  effect: PERMIT
  evaluationCacheable: true
  meta:
    owners:
      - id: urn:restorecommerce:acs:names:ownerIndicatoryEntity
        value: urn:restorecommerce:acs:model:organization.Organization
        attributes:
          - id: urn:restorecommerce:acs:names:ownerInstance
            value: system
---
  id: normal_user_token_modify_rule_condition
  name: Token modify rule
  description: Permit modify access to the token resource owned by user
  target:
    subjects:
      - id: urn:restorecommerce:acs:names:role
        value: user-r-id
    resources:
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:token.Token
    actions:
      - id: urn:oasis:names:tc:xacml:1.0:action:action-id
        value: urn:restorecommerce:acs:names:action:modify
  condition:
    "
      (request) => request?.context?.resources?.every(
        resource => resource?.meta?.owners?.some(
          owner => owner?.attributes?.some(
            attr => attr?.id === 'urn:restorecommerce:acs:names:ownerInstance' && attr?.value === request?.context?.subject?.id
          )
        )
      );
    "
  effect: PERMIT
  evaluationCacheable: true
  meta:
    owners:
      - id: urn:restorecommerce:acs:names:ownerIndicatoryEntity
        value: urn:restorecommerce:acs:model:organization.Organization
        attributes:
          - id: urn:restorecommerce:acs:names:ownerInstance
            value: system
---
  id: normal_user_token_delete_rule_condition
  name: Token delete rule
  description: Permit delete access to the token resource owned by user
  target:
    subjects:
      - id: urn:restorecommerce:acs:names:role
        value: user-r-id
    resources:
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:token.Token
    actions:
      - id: urn:oasis:names:tc:xacml:1.0:action:action-id
        value: urn:restorecommerce:acs:names:action:delete
  condition:
    "
      (request) => request?.context?.resources?.every(
        resource => resource?.meta?.owners?.some(
          owner => owner?.attributes?.some(
            attr => attr?.id === 'urn:restorecommerce:acs:names:ownerInstance' && attr?.value === request?.context?.subject?.id
          )
        )
      );
    "
  effect: PERMIT
  evaluationCacheable: true
  meta:
    owners:
      - id: urn:restorecommerce:acs:names:ownerIndicatoryEntity
        value: urn:restorecommerce:acs:model:organization.Organization
        attributes:
          - id: urn:restorecommerce:acs:names:ownerInstance
            value: system
---
  id: normal_user_token_read_rule_condition
  name: Token read rule
  description: Permit read access to the token resource owned by user
  target:
    subjects:
      - id: urn:restorecommerce:acs:names:role
        value: user-r-id
    resources:
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:token.Token
    actions:
      - id: urn:oasis:names:tc:xacml:1.0:action:action-id
        value: urn:restorecommerce:acs:names:action:read
  condition:
    "
      let filter = context?.subject?.id;
      filter;
    "
  effect: PERMIT
  evaluationCacheable: true
  meta:
    owners:
      - id: urn:restorecommerce:acs:names:ownerIndicatoryEntity
        value: urn:restorecommerce:acs:model:organization.Organization
        attributes:
          - id: urn:restorecommerce:acs:names:ownerInstance
            value: system
---
  id: unauth_user_internal_bucket_rule
  name: Object Storage rule for the internal bucket
  description: Allows unauthenticated-user to read Object storage data from the internal bucket
  target:
    subjects:
      - id: urn:restorecommerce:acs:names:unauthenticated-user
        value: "true"
    resources:
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:internal.Internal
    actions:
      - id: urn:oasis:names:tc:xacml:1.0:action:action-id
        value: urn:restorecommerce:acs:names:action:read
  effect: PERMIT
  meta:
    owners:
      - id: urn:restorecommerce:acs:names:ownerIndicatoryEntity
        value: urn:restorecommerce:acs:model:organization.Organization
        attributes:
          - id: urn:restorecommerce:acs:names:ownerInstance
            value: system
