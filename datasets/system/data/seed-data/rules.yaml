---
  id: fallback-deny-all
  name: Fallback Deny All
  description: Fallback to Deny all
  effect: DENY
  target:
    subjects: [ ]
    actions: [ ]
    resources: [ ]
  condition: ""
  evaluationCacheable: false
  contextQuery:
    filters: [ ]
    query: ""
  meta:
    modifiedBy: ""
    owners:
      - id: urn:restorecommerce:acs:names:ownerIndicatoryEntity
        value: urn:restorecommerce:acs:model:organization.Organization
        attributes:
          - id: urn:restorecommerce:acs:names:ownerInstance
            value: system
---
  id: fallback-permit-all
  name: Fallback Permit All
  description: Fallback to Permit all
  effect: PERMIT
  target:
    subjects: [ ]
    actions: [ ]
    resources: [ ]
  condition: ""
  evaluationCacheable: false
  contextQuery:
    filters: [ ]
    query: ""
  meta:
    modifiedBy: ""
    owners:
      - id: urn:restorecommerce:acs:names:ownerIndicatoryEntity
        value: urn:restorecommerce:acs:model:organization.Organization
        attributes:
          - id: urn:restorecommerce:acs:names:ownerInstance
            value: system
---
  id: administrator-permit-all-scoped
  name: Admin Permit All Rule
  description: Permits all if subject is Admin within hierarchical scope
  target:
    subjects:
      - id: urn:restorecommerce:acs:names:role
        value: administrator-r-id
      - id: urn:restorecommerce:acs:names:roleScopingEntity
        value: urn:restorecommerce:acs:model:organization.Organization
    actions: [ ]
    resources: [ ]
  effect: PERMIT
  condition: ""
  evaluationCacheable: false
  contextQuery:
    filters: [ ]
    query: ""
  meta:
    modifiedBy: ""
    owners:
      - id: urn:restorecommerce:acs:names:ownerIndicatoryEntity
        value: urn:restorecommerce:acs:model:organization.Organization
        attributes:
          - id: urn:restorecommerce:acs:names:ownerInstance
            value: system
---
  id: administrator-permit-read-scoped
  name: Admin Permit Read Rule
  description: Permits read if subject is Admin within hierarchical scope
  target:
    resources: [ ]
    subjects:
      - id: urn:restorecommerce:acs:names:role
        value: administrator-r-id
      - id: urn:restorecommerce:acs:names:roleScopingEntity
        value: urn:restorecommerce:acs:model:organization.Organization
    actions:
      - id: urn:oasis:names:tc:xacml:1.0:action:action-id
        value: urn:restorecommerce:acs:names:action:read
  effect: PERMIT
  condition: ""
  evaluationCacheable: false
  contextQuery:
    filters: [ ]
    query: ""
  meta:
    modifiedBy: ""
    owners:
      - id: urn:restorecommerce:acs:names:ownerIndicatoryEntity
        value: urn:restorecommerce:acs:model:organization.Organization
        attributes:
          - id: urn:restorecommerce:acs:names:ownerInstance
            value: system
---
  id: sales-permit-all-scoped
  name: Sales Permit All Rule
  description: Permits all if subject is Sales within hierarchical scope
  target:
    subjects:
      - id: urn:restorecommerce:acs:names:role
        value: sales-r-id
      - id: urn:restorecommerce:acs:names:roleScopingEntity
        value: urn:restorecommerce:acs:model:organization.Organization
    actions: [ ]
    resources: [ ]
  effect: PERMIT
  condition: ""
  evaluationCacheable: false
  contextQuery:
    filters: [ ]
    query: ""
  meta:
    modifiedBy: ""
    owners:
      - id: urn:restorecommerce:acs:names:ownerIndicatoryEntity
        value: urn:restorecommerce:acs:model:organization.Organization
        attributes:
          - id: urn:restorecommerce:acs:names:ownerInstance
            value: system
---
  id: sales-permit-read-scoped
  name: Sales Permit Read Rule
  description: Permits read if subject is Sales within hierarchical scope
  target:
    resources: [ ]
    subjects:
      - id: urn:restorecommerce:acs:names:role
        value: sales-r-id
      - id: urn:restorecommerce:acs:names:roleScopingEntity
        value: urn:restorecommerce:acs:model:organization.Organization
    actions:
      - id: urn:oasis:names:tc:xacml:1.0:action:action-id
        value: urn:restorecommerce:acs:names:action:read
  effect: PERMIT
  condition: ""
  evaluationCacheable: false
  contextQuery:
    filters: [ ]
    query: ""
  meta:
    modifiedBy: ""
    owners:
      - id: urn:restorecommerce:acs:names:ownerIndicatoryEntity
        value: urn:restorecommerce:acs:model:organization.Organization
        attributes:
          - id: urn:restorecommerce:acs:names:ownerInstance
            value: system
---
  id: moderator-permit-all-scoped
  name: Moderator Permit All Rule
  description: Permits all if subject is Moderator within hierarchical scope
  target:
    subjects:
      - id: urn:restorecommerce:acs:names:role
        value: moderator-r-id
      - id: urn:restorecommerce:acs:names:roleScopingEntity
        value: urn:restorecommerce:acs:model:organization.Organization
    actions: [ ]
    resources: [ ]
  effect: PERMIT
  condition: ""
  evaluationCacheable: false
  contextQuery:
    filters: [ ]
    query: ""
  meta:
    modifiedBy: ""
    owners:
      - id: urn:restorecommerce:acs:names:ownerIndicatoryEntity
        value: urn:restorecommerce:acs:model:organization.Organization
        attributes:
          - id: urn:restorecommerce:acs:names:ownerInstance
            value: system
---
  id: moderator-permit-read-scoped
  name: Moderator Permit Read Rule
  description: Permits read if subject is Moderator within hierarchical scope
  target:
    resources: [ ]
    subjects:
      - id: urn:restorecommerce:acs:names:role
        value: moderator-r-id
      - id: urn:restorecommerce:acs:names:roleScopingEntity
        value: urn:restorecommerce:acs:model:organization.Organization
    actions:
      - id: urn:oasis:names:tc:xacml:1.0:action:action-id
        value: urn:restorecommerce:acs:names:action:read
  effect: PERMIT
  condition: ""
  evaluationCacheable: false
  contextQuery:
    filters: [ ]
    query: ""
  meta:
    modifiedBy: ""
    owners:
      - id: urn:restorecommerce:acs:names:ownerIndicatoryEntity
        value: urn:restorecommerce:acs:model:organization.Organization
        attributes:
          - id: urn:restorecommerce:acs:names:ownerInstance
            value: system
---
  id: moderator-permit-create-scoped
  name: Moderator Permit Create Rule
  description: Permits create if subject is Moderator within hierarchical scope
  target:
    resources: [ ]
    subjects:
      - id: urn:restorecommerce:acs:names:role
        value: moderator-r-id
      - id: urn:restorecommerce:acs:names:roleScopingEntity
        value: urn:restorecommerce:acs:model:organization.Organization
    actions:
      - id: urn:oasis:names:tc:xacml:1.0:action:action-id
        value: urn:restorecommerce:acs:names:action:create
  effect: PERMIT
  condition: ""
  evaluationCacheable: false
  contextQuery:
    filters: [ ]
    query: ""
  meta:
    modifiedBy: ""
    owners:
      - id: urn:restorecommerce:acs:names:ownerIndicatoryEntity
        value: urn:restorecommerce:acs:model:organization.Organization
        attributes:
          - id: urn:restorecommerce:acs:names:ownerInstance
            value: system
---
  id: moderator-permit-update-scoped
  name: Moderator Permit Update Rule
  description: Permits update if subject is Moderator within hierarchical scope
  target:
    resources: [ ]
    subjects:
      - id: urn:restorecommerce:acs:names:role
        value: moderator-r-id
      - id: urn:restorecommerce:acs:names:roleScopingEntity
        value: urn:restorecommerce:acs:model:organization.Organization
    actions:
      - id: urn:oasis:names:tc:xacml:1.0:action:action-id
        value: urn:restorecommerce:acs:names:action:update
  effect: PERMIT
  condition: ""
  evaluationCacheable: false
  contextQuery:
    filters: [ ]
    query: ""
  meta:
    modifiedBy: ""
    owners:
      - id: urn:restorecommerce:acs:names:ownerIndicatoryEntity
        value: urn:restorecommerce:acs:model:organization.Organization
        attributes:
          - id: urn:restorecommerce:acs:names:ownerInstance
            value: system
---
  id: member-permit-read-scoped
  name: Member Permit Read Rule
  description: Permits read if subject is Member within hierarchical scope
  target:
    resources: [ ]
    subjects:
      - id: urn:restorecommerce:acs:names:role
        value: member-r-id
      - id: urn:restorecommerce:acs:names:roleScopingEntity
        value: urn:restorecommerce:acs:model:organization.Organization
    actions:
      - id: urn:oasis:names:tc:xacml:1.0:action:action-id
        value: urn:restorecommerce:acs:names:action:read
  effect: PERMIT
  condition: ""
  evaluationCacheable: false
  contextQuery:
    filters: [ ]
    query: ""
  meta:
    modifiedBy: ""
    owners:
      - id: urn:restorecommerce:acs:names:ownerIndicatoryEntity
        value: urn:restorecommerce:acs:model:organization.Organization
        attributes:
          - id: urn:restorecommerce:acs:names:ownerInstance
            value: system
---
  id: customer-permit-all-scoped
  name: Customer Permit All Rule
  description: Permits all if subject is Customer within hierarchical scope
  target:
    subjects:
      - id: urn:restorecommerce:acs:names:role
        value: customer-r-id
      - id: urn:restorecommerce:acs:names:roleScopingEntity
        value: urn:restorecommerce:acs:model:organization.Organization
    actions: [ ]
    resources: [ ]
  effect: PERMIT
  condition: ""
  evaluationCacheable: false
  contextQuery:
    filters: [ ]
    query: ""
  meta:
    modifiedBy: ""
    owners:
      - id: urn:restorecommerce:acs:names:ownerIndicatoryEntity
        value: urn:restorecommerce:acs:model:organization.Organization
        attributes:
          - id: urn:restorecommerce:acs:names:ownerInstance
            value: system
---
  id: customer-permit-read-scoped
  name: Customer Permit Read Rule
  description: Permits read if subject is Customer within hierarchical scope
  target:
    resources: [ ]
    subjects:
      - id: urn:restorecommerce:acs:names:role
        value: customer-r-id
      - id: urn:restorecommerce:acs:names:roleScopingEntity
        value: urn:restorecommerce:acs:model:organization.Organization
    actions:
      - id: urn:oasis:names:tc:xacml:1.0:action:action-id
        value: urn:restorecommerce:acs:names:action:read
  effect: PERMIT
  condition: ""
  evaluationCacheable: false
  contextQuery:
    filters: [ ]
    query: ""
  meta:
    modifiedBy: ""
    owners:
      - id: urn:restorecommerce:acs:names:ownerIndicatoryEntity
        value: urn:restorecommerce:acs:model:organization.Organization
        attributes:
          - id: urn:restorecommerce:acs:names:ownerInstance
            value: system
---
  id: user-permit-all-owned
  name: User Permit All Owned
  description: Permits all if resource is owned by subject
  target:
    subjects:
      - id: urn:restorecommerce:acs:names:role
        value: user-r-id
    actions: [ ]
    resources: [ ]
  effect: PERMIT
  condition:
    "
    (request) => request?.context?.resources?.every(
      resource => resource.meta?.owners?.some(
        owner => (
          owner.id === 'urn:restorecommerce:acs:names:ownerIndicatoryEntity'
          && owner.value === 'urn:restorecommerce:acs:model:organization.Organization'
          && owner.attributes?.some(
            att => (
              att.id === 'urn:restorecommerce:acs:names:ownerInstance'
              && att.value === context?.subject?.id
            )
          )
        )
      )
    );
    "
  evaluationCacheable: false
  contextQuery:
    filters: [ ]
    query: ""
  meta:
    modifiedBy: ""
    owners:
      - id: urn:restorecommerce:acs:names:ownerIndicatoryEntity
        value: urn:restorecommerce:acs:model:organization.Organization
        attributes:
          - id: urn:restorecommerce:acs:names:ownerInstance
            value: system
---
  id: user-permit-update-owned
  name: User Permit Update Owned
  description: Permits update if resource is owned by subject
  target:
    subjects:
      - id: urn:restorecommerce:acs:names:role
        value: user-r-id
    actions:
      - id: urn:oasis:names:tc:xacml:1.0:action:action-id
        value: urn:restorecommerce:acs:names:action:update
    resources: [ ]
  effect: PERMIT
  condition:
    "
    (request) => request?.context?.resources?.every(
      resource => resource.meta?.owners?.some(
        owner => (
          owner.id === 'urn:restorecommerce:acs:names:ownerIndicatoryEntity'
          && owner.value === 'urn:restorecommerce:acs:model:organization.Organization'
          && owner.attributes?.some(
            att => (
              att.id === 'urn:restorecommerce:acs:names:ownerInstance'
              && att.value === context?.subject?.id
            )
          )
        )
      )
    );
    "
  evaluationCacheable: false
  contextQuery:
    filters: [ ]
    query: ""
  meta:
    modifiedBy: ""
    owners:
      - id: urn:restorecommerce:acs:names:ownerIndicatoryEntity
        value: urn:restorecommerce:acs:model:organization.Organization
        attributes:
          - id: urn:restorecommerce:acs:names:ownerInstance
            value: system
---
  id: user-permit-read-owned
  name: User Permit Read Owned
  description: Permits read if resource is owned by subject
  target:
    subjects:
      - id: urn:restorecommerce:acs:names:role
        value: user-r-id
    actions:
      - id: urn:oasis:names:tc:xacml:1.0:action:action-id
        value: urn:restorecommerce:acs:names:action:read
    resources: [ ]
  effect: PERMIT
  condition:
    "
    (request) => request?.context?.resources?.every(
      resource => resource.meta?.owners?.some(
        owner => (
          owner.id === 'urn:restorecommerce:acs:names:ownerIndicatoryEntity'
          && owner.value === 'urn:restorecommerce:acs:model:organization.Organization'
          && owner.attributes?.some(
            att => (
              att.id === 'urn:restorecommerce:acs:names:ownerInstance'
              && att.value === context?.subject?.id
            )
          )
        )
      )
    );
    "
  evaluationCacheable: false
  contextQuery:
    filters: [ ]
    query: ""
  meta:
    modifiedBy: ""
    owners:
      - id: urn:restorecommerce:acs:names:ownerIndicatoryEntity
        value: urn:restorecommerce:acs:model:organization.Organization
        attributes:
          - id: urn:restorecommerce:acs:names:ownerInstance
            value: system
---
  id: require-order-state-created
  name: Require Order State Created
  description: Denies if order has other state than created
  target:
    subjects: [ ]
    actions: [ ]
    resources:
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:order.Order
  effect: DENY
  condition:
    "
    (request) => !request?.context?.resources?.every(
      resource => (
        !resource.order_state
        || resource.order_state?.toString() === 'UNRECOGNIZED'
        || resource.order_state?.toString() === 'CREATED'
      )
    );
    "
  evaluationCacheable: false
  contextQuery:
    filters: [ ]
    query: ""
  meta:
    modifiedBy: ""
    owners:
      - id: urn:restorecommerce:acs:names:ownerIndicatoryEntity
        value: urn:restorecommerce:acs:model:organization.Organization
        attributes:
          - id: urn:restorecommerce:acs:names:ownerInstance
            value: system
---
  id: require-order-state-submitted
  name: Require Order State Submitted
  description: Denies if order has other state than submitted
  target:
    subjects: [ ]
    actions: [ ]
    resources:
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:order.Order
  effect: DENY
  condition:
    "
    (request) => !request?.context?.resources?.every(
      resource => (
        resource.order_state?.toString() === 'SUBMITTED'
      )
    );
    "
  evaluationCacheable: false
  contextQuery:
    filters: [ ]
    query: ""
  meta:
    modifiedBy: ""
    owners:
      - id: urn:restorecommerce:acs:names:ownerIndicatoryEntity
        value: urn:restorecommerce:acs:model:organization.Organization
        attributes:
          - id: urn:restorecommerce:acs:names:ownerInstance
            value: system
---
  id: require-order-state-withdrawn
  name: Require Order State Withdrawn
  description: Denies if order has other state than withdrawn
  target:
    subjects: [ ]
    actions: [ ]
    resources:
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:order.Order
  effect: DENY
  condition:
    "
    (request) => !request?.context?.resources?.every(
      resource => (
        resource.order_state?.toString() === 'WITHDRAWM'
      )
    );
    "
  evaluationCacheable: false
  contextQuery:
    filters: [ ]
    query: ""
  meta:
    modifiedBy: ""
    owners:
      - id: urn:restorecommerce:acs:names:ownerIndicatoryEntity
        value: urn:restorecommerce:acs:model:organization.Organization
        attributes:
          - id: urn:restorecommerce:acs:names:ownerInstance
            value: system
---
  id: unauthenticated-permit-create-strict-scope
  name: Unauthenticated Create Strict Scope
  description: Permits create if subject is Unauthenticated within strict scope
  target:
    subjects:
      - id: urn:restorecommerce:acs:names:role
        value: unauthenticated-r-id
      - id: urn:restorecommerce:acs:names:roleScopingEntity
        value: urn:restorecommerce:acs:model:organization.Organization
      - id: urn:restorecommerce:acs:names:hierarchicalRoleScoping
        value: 'false'
    actions:
      - id: urn:oasis:names:tc:xacml:1.0:action:action-id
        value: urn:restorecommerce:acs:names:action:create
    resources: [ ]
  effect: PERMIT
  condition: ""
  evaluationCacheable: false
  contextQuery:
    filters: [ ]
    query: ""
  meta:
    modifiedBy: ""
    owners:
      - id: urn:restorecommerce:acs:names:ownerIndicatoryEntity
        value: urn:restorecommerce:acs:model:organization.Organization
        attributes:
          - id: urn:restorecommerce:acs:names:ownerInstance
            value: restorecommecre-demo-root-organization
---
  id: everyone-permit-read-system
  name: Everyone Permit Read System
  description: Permits read if resource is owned by system
  target:
    resources: [ ]
    subjects: [ ]
    actions:
      - id: urn:oasis:names:tc:xacml:1.0:action:action-id
        value: urn:restorecommerce:acs:names:action:read
  effect: PERMIT
  condition:
    "
    (request) => request?.context?.resources?.every(
      resource => resource.meta?.owners?.some(
        owner => (
          owner.id === 'urn:restorecommerce:acs:names:ownerIndicatoryEntity'
          && owner.value === 'urn:restorecommerce:acs:model:organization.Organization'
          && owner.attributes?.some(
            att => (
              att.id === 'urn:restorecommerce:acs:names:ownerInstance'
              && att.value === 'system'
            )
          )
        )
      )
    );
    "
  evaluationCacheable: false
  contextQuery:
    filters: [ ]
    query: ""
  meta:
    modifiedBy: ""
    owners:
      - id: urn:restorecommerce:acs:names:ownerIndicatoryEntity
        value: urn:restorecommerce:acs:model:organization.Organization
        attributes:
          - id: urn:restorecommerce:acs:names:ownerInstance
            value: system
---
  id: everyone-permit-reset-password
  name: Everyone Permit Reset Password
  description: Permits reset password to everyone
  target:
    subjects: [ ]
    actions:
      - id: urn:oasis:names:tc:xacml:1.0:action:action-id
        value: urn:restorecommerce:acs:names:action:update
    resources:
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:user.User
      - id: urn:restorecommerce:acs:names:model:property
        value: urn:restorecommerce:acs:model:user.User#activation_code
      - id: urn:restorecommerce:acs:names:model:property
        value: urn:restorecommerce:acs:model:user.User#password_hash
      - id: urn:restorecommerce:acs:names:model:property
        value: urn:restorecommerce:acs:model:user.User#email
  effect: PERMIT
  condition: ""
  evaluationCacheable: false
  contextQuery:
    filters: [ ]
    query: ""
  meta:
    modifiedBy: ""
    owners:
      - id: urn:restorecommerce:acs:names:ownerIndicatoryEntity
        value: urn:restorecommerce:acs:model:organization.Organization
        attributes:
          - id: urn:restorecommerce:acs:names:ownerInstance
            value: system