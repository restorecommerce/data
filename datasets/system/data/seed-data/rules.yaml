---
  id: fallback-rule
  name: Fallback rule
  description: Fallback to Deny
  effect: DENY
  target:
    subjects: []
    actions: []
    resources: []
  condition: ""
  evaluationCacheable: false
  contextQuery:
    filters: []
    query: ""
  meta:
    modifiedBy: ""
    owners:
      - id: urn:restorecommerce:acs:names:ownerIndicatoryEntity
        value: urn:restorecommerce:acs:model:organization.Organization
        attributes:
          - id: urn:restorecommerce:acs:names:ownerInstance
            value: system
---
  id: superadmin-rule
  name: SuperAdmins Rule
  description: Permit anything by SuperAdmins (fallback rule)
  target:
    subjects:
      - id: urn:restorecommerce:acs:names:role
        value: superadministrator-r-id
    actions: []
    resources: []
  effect: PERMIT
  condition: ""
  evaluationCacheable: false
  contextQuery:
    filters: []
    query: ""
  meta:
    modifiedBy: ""
    owners:
      - id: urn:restorecommerce:acs:names:ownerIndicatoryEntity
        value: urn:restorecommerce:acs:model:organization.Organization
        attributes:
          - id: urn:restorecommerce:acs:names:ownerInstance
            value: system
---
  id: administrator-rule
  name: Admin Rule
  description: Permits all if subject is Admin within the hierarchical scope
  target:
    subjects:
      - id: urn:restorecommerce:acs:names:role
        value: administrator-r-id
      - id: urn:restorecommerce:acs:names:roleScopingEntity
        value: urn:restorecommerce:acs:model:organization.Organization
    actions: []
    resources: []
  effect: PERMIT
  condition: ""
  evaluationCacheable: false
  contextQuery:
    filters: []
    query: ""
  meta:
    modifiedBy: ""
    owners:
      - id: urn:restorecommerce:acs:names:ownerIndicatoryEntity
        value: urn:restorecommerce:acs:model:organization.Organization
        attributes:
          - id: urn:restorecommerce:acs:names:ownerInstance
            value: system
---
  id: admin-system-roles-read-rule
  name: Admin system role read rule
  description: Allows Admin to read all Roles in system
  target:
    subjects:
      - id: urn:restorecommerce:acs:names:role
        value: administrator-r-id
    actions:
      - id: urn:oasis:names:tc:xacml:1.0:action:action-id
        value: urn:restorecommerce:acs:names:action:read
    resources:
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:role.Role
  effect: PERMIT
  condition:
    "
    (request) => request?.context?.resources?.every(
      resource => resource.meta?.owners?.some(
        owner => (
          owner.id === 'urn:restorecommerce:acs:names:ownerIndicatoryEntity'
          && owner.value === 'urn:restorecommerce:acs:model:organization.Organization'
          && owner.attributes?.some(
            att => (
              att.id === 'urn:restorecommerce:acs:names:ownerInstance'
              && att.value === 'system'
            )
          )
        )
      )
    );
    "
  evaluationCacheable: false
  contextQuery:
    filters: []
    query: ""
  meta:
    modifiedBy: ""
    owners:
      - id: urn:restorecommerce:acs:names:ownerIndicatoryEntity
        value: urn:restorecommerce:acs:model:organization.Organization
        attributes:
          - id: urn:restorecommerce:acs:names:ownerInstance
            value: system
---
  id: admin-orga-roles-read-rule
  name: Admin orga role read rule
  description: Allows Admin to read all Roles in orga scope
  target:
    subjects:
      - id: urn:restorecommerce:acs:names:role
        value: administrator-r-id
      - id: urn:restorecommerce:acs:names:roleScopingEntity
        value: urn:restorecommerce:acs:model:organization.Organization
    actions:
      - id: urn:oasis:names:tc:xacml:1.0:action:action-id
        value: urn:restorecommerce:acs:names:action:read
    resources:
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:role.Role
  effect: PERMIT
  condition: ""
  evaluationCacheable: false
  contextQuery:
    filters: []
    query: ""
  meta:
    modifiedBy: ""
    owners:
      - id: urn:restorecommerce:acs:names:ownerIndicatoryEntity
        value: urn:restorecommerce:acs:model:organization.Organization
        attributes:
          - id: urn:restorecommerce:acs:names:ownerInstance
            value: system
---
  id: moderator-organization-user-read-create-rule
  name: Moderator Organization User read create rule
  description: Permits actions on users in organizational scope
  target:
    subjects:
      - id: urn:restorecommerce:acs:names:role
        value: moderator-r-id
      - id: urn:restorecommerce:acs:names:roleScopingEntity
        value: urn:restorecommerce:acs:model:organization.Organization
    actions:
      - id: urn:oasis:names:tc:xacml:1.0:action:action-id
        value: urn:restorecommerce:acs:names:action:read
      - id: urn:oasis:names:tc:xacml:1.0:action:action-id
        value: urn:restorecommerce:acs:names:action:create
      - id: urn:oasis:names:tc:xacml:1.0:action:action-id
        value: urn:restorecommerce:acs:names:action:delete
    resources:
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:user.User
  effect: PERMIT
  condition: ""
  evaluationCacheable: false
  contextQuery:
    filters: []
    query: ""
  meta:
    modifiedBy: ""
    owners:
      - id: urn:restorecommerce:acs:names:ownerIndicatoryEntity
        value: urn:restorecommerce:acs:model:organization.Organization
        attributes:
          - id: urn:restorecommerce:acs:names:ownerInstance
            value: system
---
  id: moderator-organization-resource-read-modify-rule
  name: Moderator Organization Resource read modify rule
  description: Permits read on resources in organizational scope
  target:
    subjects:
      - id: urn:restorecommerce:acs:names:role
        value: moderator-r-id
      - id: urn:restorecommerce:acs:names:roleScopingEntity
        value: urn:restorecommerce:acs:model:organization.Organization
    actions:
      - id: urn:oasis:names:tc:xacml:1.0:action:action-id
        value: urn:restorecommerce:acs:names:action:read
      - id: urn:oasis:names:tc:xacml:1.0:action:action-id
        value: urn:restorecommerce:acs:names:action:modify
    resources:
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:organization.Organization
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:customer.Customer
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:contact_point.ContactPoint
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:address.Address
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:ostorage.Ostorage
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:internal.Internal
  effect: PERMIT
  condition: ""
  evaluationCacheable: false
  contextQuery:
    filters: []
    query: ""
  meta:
    modifiedBy: ""
    owners:
      - id: urn:restorecommerce:acs:names:ownerIndicatoryEntity
        value: urn:restorecommerce:acs:model:organization.Organization
        attributes:
          - id: urn:restorecommerce:acs:names:ownerInstance
            value: system
---
  id: moderator-organization-order-read-rule
  name: Moderator Organization Order read rule
  description: Permits read on orders in organizational scope
  target:
    subjects:
      - id: urn:restorecommerce:acs:names:role
        value: moderator-r-id
      - id: urn:restorecommerce:acs:names:roleScopingEntity
        value: urn:restorecommerce:acs:model:organization.Organization
    actions:
      - id: urn:oasis:names:tc:xacml:1.0:action:action-id
        value: urn:restorecommerce:acs:names:action:read
    resources:
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:order.Order
  effect: PERMIT
  condition: ""
  evaluationCacheable: false
  contextQuery:
    filters: []
    query: ""
  meta:
    modifiedBy: ""
    owners:
      - id: urn:restorecommerce:acs:names:ownerIndicatoryEntity
        value: urn:restorecommerce:acs:model:organization.Organization
        attributes:
          - id: urn:restorecommerce:acs:names:ownerInstance
            value: system
---
  id: member-organization-resource-read-rule
  name: Member Organization Resource read rule
  description: Permits read if the resource is in organizational scope
  target:
    subjects:
      - id: urn:restorecommerce:acs:names:role
        value: member-r-id
      - id: urn:restorecommerce:acs:names:roleScopingEntity
        value: urn:restorecommerce:acs:model:organization.Organization
    actions:
      - id: urn:oasis:names:tc:xacml:1.0:action:action-id
        value: urn:restorecommerce:acs:names:action:read
    resources:
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:organization.Organization
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:customer.Customer
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:contact_point_type.ContactPointType
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:contact_point.ContactPoint
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:country.Country
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:address.Address
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:locale.Locale
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:timezone.Timezone
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:tax_type.TaxType
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:tax.Tax
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:unit_code.UnitCode
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:ostorage.Ostorage
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:internal.Internal
  effect: PERMIT
  condition: ""
  evaluationCacheable: false
  contextQuery:
    filters: []
    query: ""
  meta:
    modifiedBy: ""
    owners:
      - id: urn:restorecommerce:acs:names:ownerIndicatoryEntity
        value: urn:restorecommerce:acs:model:organization.Organization
        attributes:
          - id: urn:restorecommerce:acs:names:ownerInstance
            value: system
---
  id: member-ostorage-bucket-modify-rule
  name: Object Storage rule
  description: Allows members to perform Modify on Object storage data on his organization
  target:
    subjects:
      - id: urn:restorecommerce:acs:names:role
        value: member-r-id
      - id: urn:restorecommerce:acs:names:roleScopingEntity
        value: urn:restorecommerce:acs:model:organization.Organization
    resources:
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:ostorage.Ostorage
    actions:
      - id: urn:oasis:names:tc:xacml:1.0:action:action-id
        value: urn:restorecommerce:acs:names:action:modify
  effect: PERMIT
  condition:
    "
    (request) => request?.context?.resources?.every(
      resource => resource.meta?.owners?.some(
        owner => (
          owner.id === 'urn:restorecommerce:acs:names:ownerIndicatoryEntity'
          && owner.value === 'urn:restorecommerce:acs:model:organization.Organization'
          && owner.attributes?.some(
            att => (
              att.id === 'urn:restorecommerce:acs:names:ownerInstance'
              && att.value === context?.subject?.id
            )
          )
        )
      )
    );
    "
  evaluationCacheable: false
  contextQuery:
    filters: []
    query: ""
  meta:
    modifiedBy: ""
    owners:
      - id: urn:restorecommerce:acs:names:ownerIndicatoryEntity
        value: urn:restorecommerce:acs:model:organization.Organization
        attributes:
          - id: urn:restorecommerce:acs:names:ownerInstance
            value: system
---
  id: customer-organization-resource-read-rule
  name: Customer Organization Resource read rule
  description: Permits any read if the resource is in organizational scope
  target:
    subjects:
      - id: urn:restorecommerce:acs:names:role
        value: customer-r-id
      - id: urn:restorecommerce:acs:names:roleScopingEntity
        value: urn:restorecommerce:acs:model:organization.Organization
    actions:
      - id: urn:oasis:names:tc:xacml:1.0:action:action-id
        value: urn:restorecommerce:acs:names:action:read
    resources:
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:organization.Organization
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:customer.Customer
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:shop.Shop
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:contact_point_type.ContactPointType
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:contact_point.ContactPoint
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:country.Country
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:address.Address
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:locale.Locale
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:timezone.Timezone
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:tax_type.TaxType
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:tax.Tax
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:unit_code.UnitCode
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:manufacturer:Manufacturer
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:price_groupe:PriceGroup
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:product_category:ProductCategory
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:product:Product
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:ostorage.Ostorage
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:internal.Internal
  effect: PERMIT
  condition: ""
  evaluationCacheable: false
  contextQuery:
    filters: []
    query: ""
  meta:
    modifiedBy: ""
    owners:
      - id: urn:restorecommerce:acs:names:ownerIndicatoryEntity
        value: urn:restorecommerce:acs:model:organization.Organization
        attributes:
          - id: urn:restorecommerce:acs:names:ownerInstance
            value: system
---
  id: customer-order-submit-rule
  name: Customer Order Submit rule
  description: Permits to submit orders in organizational scope
  target:
    subjects:
      - id: urn:restorecommerce:acs:names:role
        value: customer-r-id
      - id: urn:restorecommerce:acs:names:roleScopingEntity
        value: urn:restorecommerce:acs:model:organization.Organization
    actions:
      - id: urn:oasis:names:tc:xacml:1.0:action:action-id
        value: urn:restorecommerce:acs:names:action:execute
    resources:
      - id: urn:restorecommerce:acs:names:operation
        value: execution.submitOrders
  effect: PERMIT
  condition:
    "
    (request) => request?.context?.resources?.every(
      resource => (
        resource.user_id === context?.subject?.id
        && (
          !resource.order_state
          || resource.order_state?.toString() === 'UNRECOGNIZED'
          || resource.order_state?.toString() === 'CREATED'
        )
      )
    );
    "
  evaluationCacheable: false
  contextQuery:
    filters: []
    query: ""
  meta:
    modifiedBy: ""
    owners:
      - id: urn:restorecommerce:acs:names:ownerIndicatoryEntity
        value: urn:restorecommerce:acs:model:organization.Organization
        attributes:
          - id: urn:restorecommerce:acs:names:ownerInstance
            value: system
---
  id: customer-order-withdraw-rule
  name: Customer Order Withdraw Rule
  description: Permits Order withdraw under condition and organizational hierarchical scope
  target:
    subjects:
      - id: urn:restorecommerce:acs:names:role
        value: customer-r-id
      - id: urn:restorecommerce:acs:names:roleScopingEntity
        value: urn:restorecommerce:acs:model:organization.Organization
    actions:
      - id: urn:oasis:names:tc:xacml:1.0:action:action-id
        value: urn:restorecommerce:acs:names:action:execute
    resources:
      - id: urn:restorecommerce:acs:names:operation
        value: execution.withdrawOrders
  effect: PERMIT
  condition:
    "
    (request) => request?.context?.resources?.every(
      resource => (
        resource.user_id === context?.subject?.id
        && resource.order_state?.toString() === 'SUBMITTED'
      )
    );
    "
  evaluationCacheable: false
  contextQuery:
    filters: [ ]
    query: ""
  meta:
    modifiedBy: ""
    owners:
      - id: urn:restorecommerce:acs:names:ownerIndicatoryEntity
        value: urn:restorecommerce:acs:model:organization.Organization
        attributes:
          - id: urn:restorecommerce:acs:names:ownerInstance
            value: system
---
  id: user-owned-resource-read-modify-rule
  name: User owned Resource read modify rule
  description: Permits read modify on owned resources
  target:
    subjects:
      - id: urn:restorecommerce:acs:names:role
        value: user-r-id
    actions:
      - id: urn:oasis:names:tc:xacml:1.0:action:action-id
        value: urn:restorecommerce:acs:names:action:read
      - id: urn:oasis:names:tc:xacml:1.0:action:action-id
        value: urn:restorecommerce:acs:names:action:modify
    resources:
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:organization.Organization
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:customer.Customer
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:contact_point.ContactPoint
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:address.Address
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:ostorage.Ostorage
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:internal.Internal
  effect: PERMIT
  condition:
    "
    (request) => request?.context?.resources?.every(
      resource => resource.meta?.owners?.some(
        owner => (
          owner.id === 'urn:restorecommerce:acs:names:ownerIndicatoryEntity'
          && owner.value === 'urn:restorecommerce:acs:model:organization.Organization'
          && owner.attributes?.some(
            att => (
              att.id === 'urn:restorecommerce:acs:names:ownerInstance'
              && att.value === context?.subject?.id
            )
          )
        )
      )
    );
    "
  evaluationCacheable: false
  contextQuery:
    filters: []
    query: ""
  meta:
    modifiedBy: ""
    owners:
      - id: urn:restorecommerce:acs:names:ownerIndicatoryEntity
        value: urn:restorecommerce:acs:model:organization.Organization
        attributes:
          - id: urn:restorecommerce:acs:names:ownerInstance
            value: system
---
  id: user-user-read-modify-rule
  name: User Account Rule
  description: Permits actions by any User on its own account data
  target:
    subjects:
      - id: urn:restorecommerce:acs:names:role
        value: user-r-id # Normal User
    resources:
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:user.User
    actions:
      - id: urn:oasis:names:tc:xacml:1.0:action:action-id
        value: urn:restorecommerce:acs:names:action:read
      - id: urn:oasis:names:tc:xacml:1.0:action:action-id
        value: urn:restorecommerce:acs:names:action:modify
  condition: "context?.subject?.id"
  effect: PERMIT
  evaluationCacheable: false
  contextQuery:
    filters: [ ]
    query: ""
  meta:
    modifiedBy: ""
    owners:
      - id: urn:restorecommerce:acs:names:ownerIndicatoryEntity
        value: urn:restorecommerce:acs:model:organization.Organization
        attributes:
          - id: urn:restorecommerce:acs:names:ownerInstance
            value: system
---
  id: user-order-read-modify-rule
  name: User Order Modify rule
  description: Permits to create and modify orders owned by user
  target:
    subjects:
      - id: urn:restorecommerce:acs:names:role
        value: user-r-id
    actions:
      - id: urn:oasis:names:tc:xacml:1.0:action:action-id
        value: urn:restorecommerce:acs:names:action:read
      - id: urn:oasis:names:tc:xacml:1.0:action:action-id
        value: urn:restorecommerce:acs:names:action:modify
    resources:
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:order.Order
  effect: PERMIT
  condition:
    "
    (request) => request?.context?.resources?.every(
      resource => (
        resource.user_id === context?.subject?.id
        && (
          !resource.order_state
          || resource.order_state?.toString() === 'UNRECOGNIZED'
          || resource.order_state?.toString() === 'CREATED'
        )
      )
    );
    "
  evaluationCacheable: false
  contextQuery:
    filters: []
    query: ""
  meta:
    modifiedBy: ""
    owners:
      - id: urn:restorecommerce:acs:names:ownerIndicatoryEntity
        value: urn:restorecommerce:acs:model:organization.Organization
        attributes:
          - id: urn:restorecommerce:acs:names:ownerInstance
            value: system
---
  id: unauthenticated-register-user-rule
  name: Register new User rule
  description: Register new User as Unauthenticated User
  target:
    subjects:
      - id: urn:restorecommerce:acs:names:role
        value: unauthenticated-user-r-id
      - id: urn:restorecommerce:acs:names:roleScopingEntity
        value: urn:restorecommerce:acs:model:organization.Organization
      - id: urn:restorecommerce:acs:names:hierarchicalRoleScoping
        value: 'false'
    actions:
      - id: urn:oasis:names:tc:xacml:1.0:action:action-id
        value: urn:restorecommerce:acs:names:action:create
    resources:
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:user.User
  effect: PERMIT
  condition: ""
  evaluationCacheable: false
  contextQuery:
    filters: []
    query: ""
  meta:
    modifiedBy: ""
    owners:
      - id: urn:restorecommerce:acs:names:ownerIndicatoryEntity
        value: urn:restorecommerce:acs:model:organization.Organization
        attributes:
          - id: urn:restorecommerce:acs:names:ownerInstance
            value: restorecommecre-demo-root-organization
---
  id: unauthenticated-forgot-password-rule
  name: User 'Forgot Password' rule
  description: Permits 'modify' by unauthenticated users on their password
  target:
    subjects:
      - id: urn:restorecommerce:acs:names:role
        value: unauthenticated-user-r-id
      - id: urn:restorecommerce:acs:names:roleScopingEntity
        value: urn:restorecommerce:acs:model:organization.Organization
    actions:
      - id: urn:oasis:names:tc:xacml:1.0:action:action-id
        value: urn:restorecommerce:acs:names:action:modify
    resources:
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:user.User
      - id: urn:restorecommerce:acs:names:model:property
        value: urn:restorecommerce:acs:model:user.User#activation_code
      - id: urn:restorecommerce:acs:names:model:property
        value: urn:restorecommerce:acs:model:user.User#password_hash
      - id: urn:restorecommerce:acs:names:model:property
        value: urn:restorecommerce:acs:model:user.User#email
  effect: PERMIT
  condition: ""
  evaluationCacheable: false
  contextQuery:
    filters: [ ]
    query: ""
  meta:
    modifiedBy: ""
    owners:
      - id: urn:restorecommerce:acs:names:ownerIndicatoryEntity
        value: urn:restorecommerce:acs:model:organization.Organization
        attributes:
          - id: urn:restorecommerce:acs:names:ownerInstance
            value: system
---
  id: everyone-own-token-read-modify-rule
  name: Token read and modify rule
  description: Permit modify access to the token resource owned by user
  target:
    subjects: []
    actions:
      - id: urn:oasis:names:tc:xacml:1.0:action:action-id
        value: urn:restorecommerce:acs:names:action:read
      - id: urn:oasis:names:tc:xacml:1.0:action:action-id
        value: urn:restorecommerce:acs:names:action:modify
    resources:
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:token.Token
  condition: "context?.subject?.id;"
  effect: PERMIT
  evaluationCacheable: true
  meta:
    owners:
      - id: urn:restorecommerce:acs:names:ownerIndicatoryEntity
        value: urn:restorecommerce:acs:model:organization.Organization
        attributes:
          - id: urn:restorecommerce:acs:names:ownerInstance
            value: system
---
  id: everyone-system-resource-read-rule
  name: Everyone system resource read rule
  description: Permits read of system resources to everyone
  target:
    subjects: []
    actions:
      - id: urn:oasis:names:tc:xacml:1.0:action:action-id
        value: urn:restorecommerce:acs:names:action:read
    resources:
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:contact_point_type.ContactPointType
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:contact_point.ContactPoint
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:country.Country
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:address.Address
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:locale.Locale
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:timezone.Timezone
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:tax_type.TaxType
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:tax.Tax
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:unit_code.UnitCode
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:ostorage.Ostorage
      - id: urn:restorecommerce:acs:names:model:entity
        value: urn:restorecommerce:acs:model:internal.Internal
  effect: PERMIT
  condition:
    "
    (request) => request?.context?.resources?.every(
      resource => resource.meta?.owners?.some(
        owner => (
          owner.id === 'urn:restorecommerce:acs:names:ownerIndicatoryEntity'
          && owner.value === 'urn:restorecommerce:acs:model:organization.Organization'
          && owner.attributes?.some(
            att => (
              att.id === 'urn:restorecommerce:acs:names:ownerInstance'
              && att.value === 'system'
            )
          )
        )
      )
    );
    "
  evaluationCacheable: false
  contextQuery:
    filters: []
    query: ""
  meta:
    modifiedBy: ""
    owners:
      - id: urn:restorecommerce:acs:names:ownerIndicatoryEntity
        value: urn:restorecommerce:acs:model:organization.Organization
        attributes:
          - id: urn:restorecommerce:acs:names:ownerInstance
            value: system
